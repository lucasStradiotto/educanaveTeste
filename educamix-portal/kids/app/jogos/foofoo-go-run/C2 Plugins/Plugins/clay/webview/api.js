(function(){var local,_base,__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};local={};if(typeof window.Clay==="undefined"){window.Clay={};local.loadNow=false}else{local.loadNow=true}Clay.PROTOCOL||(Clay.PROTOCOL=document&&document.location&&("https:"===document.location.protocol||"chrome-extension:"===document.location.protocol)?"https://":"http://");Clay.BASEURL||(Clay.BASEURL=Clay.PROTOCOL+"clay.io");Clay.DOMAIN||(Clay.DOMAIN="clay.io");Clay.options||(Clay.options={debug:false});Clay.readyFunctions||(Clay.readyFunctions=[]);Clay["ready"]||(Clay["ready"]=function(fn){return Clay["readyFunctions"].push(fn)});Clay.loadFunctions||(Clay.loadFunctions=[]);Clay["load"]||(Clay["load"]=function(fn){return Clay["loadFunctions"].push(fn)});Clay.windows8=false;if(navigator.userAgent.indexOf("MSAppHost")!==-1&&typeof Windows!=="undefined"){(_base=Clay.options).noExternal||(_base.noExternal=true);Clay.windows8=true}Clay.orientation=window.orientation;Clay.publisherID=0;Clay.source=true;this.namespace=function(target,name,block){var item,top,_i,_len,_ref,_ref1;if(arguments.length<3){_ref=[typeof exports!=="undefined"?exports:window].concat(__slice.call(arguments)),target=_ref[0],name=_ref[1],block=_ref[2]}top=target;_ref1=name.split(".");for(_i=0,_len=_ref1.length;_i<_len;_i++){item=_ref1[_i];target=target[item]||(target[item]={})}return block(target,top)};namespace("Clay",function(exports){exports.log=function(msg,force){if(force==null){force=false}if(typeof console!=="undefined"&&(force||exports.options&&exports.options.debug)){return console.log(msg)}};exports.checkDevice=function(){var agent,device;agent=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(agent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(agent.substr(0,4))){device="mobile"}else{device="desktop"}return device};local.DOMLoaded=false;local.DOMReady=false;local.ready=function(){var contentLoaded,fns,ready,scrollCheck,toplevel,w3c;exports.log("Local Ready Called");contentLoaded=function(){if(w3c){document.removeEventListener("DOMContentLoaded",contentLoaded,true)}else if(document.readyState==="complete"||document.readyState==="interactive"){document.detachEvent("onreadystatechange",contentLoaded)}return ready()};scrollCheck=function(){if(local.DOMLoaded){return}try{document.documentElement.doScroll("left")}catch(e){window.setTimeout(arguments_.callee,15);return}return ready()};ready=function(){var i,len,_results;if(local.DOMLoaded){return}local.DOMLoaded=true;len=fns.length;i=0;exports.log("Local Ready Fired");_results=[];while(i<len){fns[i].call(document);_results.push(i++)}return _results};w3c=!!document.addEventListener;local.DOMLoaded=false;toplevel=false;fns=[];if(document.readyState==="complete"||document.readyState==="loaded"||document.readyState==="interactive"){ready()}else if(w3c){document.addEventListener("DOMContentLoaded",contentLoaded,true);window.addEventListener("load",ready,false)}else{document.attachEvent("onreadystatechange",contentLoaded);window.attachEvent("onload",ready);try{toplevel=window.frameElement===null}catch(_error){}if(document.documentElement.doScroll&&toplevel){scrollCheck()}}return function(fn){if(local.DOMLoaded){return setTimeout(function(){return fn.call(document)},0)}else{return fns.push(fn)}}}();exports.passToNode=function(json){var load;load=function(json){if(exports.loaded){return local.Events.socketEmit("user","login",json)}else{return setTimeout(function(){return load(json)},100)}};load(json);return local.removeJsonp("passToNode")};local.jsonp=function(action,params,callback){var script,tag;if(!exports.options.noExternal){script=document.createElement("script");script.type="text/javascript";script.src=Clay.BASEURL+"/ajax/"+action+"?time="+(new Date).getTime()+"&callback=Clay."+callback+"&"+local.objToParams(params);script.id="clay-callback-"+callback;tag=document.getElementsByTagName("script")[0];return tag.parentNode.insertBefore(script,tag)}};local.focusedFrame=null;local.sendMessageToFrame=function(json){if(local.focusedFrame){json=JSON.stringify(json);return local.focusedFrame.contentWindow.postMessage(json,"*")}else{return exports.log("Attempting to post message to frame that doesn't exist")}};local.objToParams=function(obj){var p,url;url=[];for(p in obj){if(obj.hasOwnProperty(p)){url.push(p+"="+encodeURIComponent(obj[p]))}}return url.join("&")};local.objectLength=function(obj){var key,size;size=0;for(key in obj){if(obj.hasOwnProperty(key)){size++}}return size};local.removeJsonp=function(callbackName){var ele;ele=document.getElementById("clay-callback-"+callbackName);if(ele){return ele.parentNode.removeChild(ele)}};local.htmlEntities=function(str){return String(str).replace(/&amp;/g,"&").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};local.pad=function(number,length){var str;str=""+number;while(str.length<length){str="0"+str}return str};local.formatTime=function(time,type){var t,timeDiff;if(type==null){type="ago"}timeDiff=local.curTime-time;if(timeDiff>3600*24*31){if((t=Math.floor(timeDiff/(30.4368333*3600*24)))===1){return t+" month ago"}else{return t+" months ago"}}else if(timeDiff>3600*24){if((t=Math.floor(timeDiff/(3600*24)))===1){return t+" day ago"}else{return t+" days ago"}}else if(timeDiff>3600){if((t=Math.floor(timeDiff/3600))===1){return t+" hour ago"}else{return t+" hours ago"}}else if(timeDiff>60){if((t=Math.floor(timeDiff/60))===1){return t+" minute ago"}else{return t+" minutes ago"}}else{return"less than 1 minute ago"}};local.getGameLink=function(){try{if(window.top&&window.top.location&&window.top.location.href){return window.top.location.href}}catch(e){}return window.location.href};return local.validCall=function(){var consoleOpen;if(exports.options&&exports.options.debug||window.CocoonJS&&window.CocoonJS.App){return true}consoleOpen=false;if(console&&console.profile&&console.profiles){console.profile();console.profileEnd();consoleOpen=console.profiles.length>0}if(consoleOpen){exports.log("This cannot be run with the console open",true)}return!consoleOpen}});namespace("Clay",function(exports){return exports.User=function(){function User(){this.loggedIn=false;this.clearance="site";this.installed=false;this.identifier=0;this.callbacks=[];this.localStorageChecked=false}User.prototype.socketListen=function(){return local.Events.socketListen("user",this,null,false)};User.prototype.setUsername=function(username){var sendObj;sendObj={username:username};return local.Events.socketEmit("user",sendObj)};User.prototype.hasRated=function(){};User.prototype.saveUserData=function(dataKey,data,callback){var callbackId,options;if(callback==null){callback=false}callbackId=local.Callbacks.add(callback);options={dataKey:dataKey,data:data};if(local.Offline.offline){this.saveUserDataCallback(null,callbackId);return local.Offline.save("user","userData",dataKey,options,true)}else{return local.Events.socketEmit("user","saveUserData",options,false,callbackId)}};User.prototype.saveUserDataCallback=function(response,callbackId){return local.Callbacks.execute(callbackId,[response])};User.prototype.fetchUserData=function(key,callback){var callbackId,data,obj,options;if(callback==null){callback=false}callbackId=local.Callbacks.add(callback);options={dataKey:key};if(local.Offline.offline){data=local.Offline.fetch("user","userData",key);obj={data:data?data:null,success:true,key:key};return this.fetchUserDataCallback(obj,callbackId)}else{return local.Events.socketEmit("user","fetchUserData",options,false,callbackId)}};User.prototype.fetchUserDataCallback=function(response,callbackId){return local.Callbacks.execute(callbackId,[response])};User.storeUserData=function(dataKey,data,callback){if(callback==null){callback=false}localStorage["clayData"]||(localStorage["clayData"]={});localStorage["clayData"][dataKey]=data;return callback({success:true,key:dataKey})};User.fetchUserDataLocal=function(key,callback){var data;if(callback==null){callback=false}data=localStorage["clayData"]||{};return callback({success:true,key:key,data:[dataKey]})};User.prototype.fetchItems=function(callback){var callbackId;callbackId=local.Callbacks.add(callback);return local.Events.socketEmit("user","fetchItems",{},false,callbackId)};User.prototype.fetchItemsCallback=function(data,callbackId){return local.Callbacks.execute(callbackId,[data])};User.prototype.grantItem=function(options,callback){var callbackId;if(callback==null){callback=false}callbackId=local.Callbacks.add(callback);return local.Events.socketEmit("user","grantItem",options,false,callbackId)};User.prototype.grantItemCallback=function(data,callbackId){if(!data.error){exports.UI.createNotification({title:"Item Granted!",html:"You just got "+data.quantity+": "+data.item.name+"!"})}return local.Callbacks.execute(callbackId,[data])};User.prototype.removeItem=function(options,callback){var callbackId;if(callback==null){callback=false}callbackId=local.Callbacks.add(callback);return local.Events.socketEmit("user","removeItem",options,false,callbackId)};User.prototype.removeItemCallback=function(data,callbackId){return local.Callbacks.execute(callbackId,[data])};User.prototype.purchaseGame=function(callback){var pay;pay=new exports.Payment;return pay.addItem({type:"game",id:exports.gameID},function(){return pay.checkout(callback)})};User.prototype.hasInstalled=function(){return this.installed};User.prototype.getName=function(){return this.data["name"]||this.data["username"]};User.prototype.onUserReady=function(callback){return this.onLogin(callback)};User.prototype.onLogin=function(callback){if(this.identifier){return callback({name:this.getName(),identifier:this.identifier})}else{return this.userReadyCallback=callback}};User.prototype.doLogin=function(obj){var callbackId,id,json,_ref;exports.log("Clay.io is ready");if(obj.success){this.clearance=obj.clearance;this.installed=obj.installed||false;this.identifier=obj.identifier||"no-identifier";if(exports.Facebook){exports.Facebook.linked=obj.facebookLinked}if(exports.Twitter){exports.Twitter.linked=obj.twitterLinked}this.loggedIn=true;this.data=obj.data;if(this.userReadyCallback){this.userReadyCallback({identifier:this.identifier,name:this.getName()})}_ref=this.callbacks;for(id in _ref){callbackId=_ref[id];local.Callbacks.execute(callbackId,[{success:true,error:false}])}if(this.successfulJSON&&this.clearance==="clay"){localStorage.setItem("clayLogin",JSON.stringify(this.successfulJSON))}if(obj.fromPrompt){exports.UI.closeModal("clay-login-wrapper",false)}}else if(obj.loginPrompt){if(!this.localStorageChecked&&(json=localStorage.getItem("clayLogin"))){json=JSON.parse(json);this.sendLogin(json);this.localStorageChecked=true}else{this.login({signup:true})}}else if(obj.error){exports.log(obj.error)}return local.callReadies()};User.tryLogin=function(){exports.log("Trying Login");if(local.Offline.offline){return exports.log("Initiating Offline Mode")}else if(!localStorage.getItem("clayLogin")&&!exports.options.noExternal){return local.jsonp("APIGetUserInfo",{},"passToNode")}else{return local.windowsRequestLogin=true}};User.prototype.setLoginTab=function(tab){var frame,modal;frame=document.getElementById("clay-login-iframe");if(frame){frame.style.height=""}modal=document.getElementById("clay-login-wrapper");modal.className=modal.className.replace(/clay-signup-wrapper|clay-guest-wrapper|clay-login-wrapper/,"clay-"+tab+"-wrapper");return local.sendMessageToFrame({tab:tab})};User.prototype.login=function(options,callback,signup){var className,ele,events,frameSrc,handler,listenCallback,loginHTML,modalCallback,modalOptions,onClick,params,signupTmp,tabs,_this=this;if(options==null){options={}}if(callback==null){callback=false}if(signup==null){signup=false}if(typeof options!=="object"){signupTmp=callback;callback=options;options=signup||{};signup=signupTmp}signup||(signup=options.signup);options||(options={});if(callback){this.callbacks.push(local.Callbacks.add(callback))}loginHTML=[];params=[];if(signup){params.push("signup")}if(options.requireLogin){params.push("require")}if(options.signupType){params.push("signup_type="+options.signupType)}ele=document.getElementById("clay-login-wrapper");tabs=[];onClick=function(){return _this.setLoginTab("login")};tabs.push({name:"Login",focused:!signup,callback:onClick});if(!options.requireLogin&&!exports.Game.data.forceSignup){onClick=function(){return _this.setLoginTab("guest")};tabs.push({name:"Guest",focused:false,callback:onClick})}onClick=function(){return _this.setLoginTab("signup")};tabs.push({name:"Signup",focused:signup,callback:onClick});className=signup?"clay-signup-wrapper":"clay-login-wrapper";modalOptions={title:options.title||"Enable Clay.io",html:loginHTML,id:"clay-login-wrapper","class":className,tabs:tabs,DOMid:options.id};events=[];frameSrc="https://"+Clay.DOMAIN+"/api/login/"+exports.gameKey+"?"+params.join("&");if(options.prerenderedFrame){modalOptions["html"]="<div id='clay-login-prerender-wrapper'></div>";local.focusedFrame=options.prerenderedFrame;frameSrc=local.focusedFrame.src;modalCallback=function(){var wrapper;options.prerenderedFrame.style.display="block";wrapper=document.getElementById("clay-login-prerender-wrapper");if(wrapper){return wrapper.appendChild(options.prerenderedFrame)}}}else{modalOptions["iframe"]={src:frameSrc,id:"clay-login-iframe","class":"clay-"+(signup?"signup":"login")+"-iframe"};modalCallback=false}if(!ele||ele.style.display==="none"){exports.UI.createModal(modalOptions,modalCallback)}handler=function(){var callbackId,id,_ref,_ref1,_results,_results1;if(!exports.Game.data.forceSignup&&!options.requireLogin&&!_this.loggedIn){return _this.sendLogin({name:"Anonymous"})}else if(!_this.loggedIn){_ref=_this.callbacks;_results=[];for(id in _ref){callbackId=_ref[id];_results.push(local.Callbacks.execute(callbackId,[{success:false,error:"Not logged in"}]))}return _results}else{_ref1=_this.callbacks;_results1=[];for(id in _ref1){callbackId=_ref1[id];_results1.push(local.Callbacks.execute(callbackId,[{success:true,error:false}]))}return _results1}};local.Events.addEvent("closemodal",handler,false,true,document.getElementById(modalOptions.id));listenCallback=function(event){var json;if(~frameSrc.indexOf(event.origin)){json=JSON.parse(event.data);if(json.popup){exports.UI.showPopupNotifier(json.popup)}else if(json.popupClose){exports.UI.hidePopupNotifier(json.popupClose)}if(json.openCocoonJSLink){CocoonJS.App.openURL(openCocoonJSLink)}if(json.height){ele=document.getElementById("clay-login-iframe");if(ele){ele.style.height=json.height+"px"}exports.UI.centerModal("clay-login-wrapper")}if(json.tab){_this.setLoginTab(json.tab)}if(json.success||json.hash||json.name){_this.sendLogin(json);exports.UI.closeModal("clay-login-wrapper",false);return local.Events.removeEvent("message",arguments.callee)}}};return local.Events.addEvent("message",listenCallback)};User.prototype.logout=function(options,callback){var callbackId,handler,listenCallback,modalOptions,_this=this;if(options==null){options={}}if(callback==null){callback=false}callbackId=local.Callbacks.add(callback);modalOptions={title:"Logout",html:null,id:"clay-logout-wrapper",iframe:{src:exports.BASEURL+"/api/logout/"+exports.gameKey,id:"clay-logout-iframe","class":"clay-logout-iframe"},DOMid:options.id};exports.UI.createModal(modalOptions);handler=function(){return local.Callbacks.execute(callbackId,[{success:true,error:"Window closed without logging out"}])};local.Events.addEvent("closemodal",handler,false,true,document.getElementById(modalOptions.id));listenCallback=function(event){var ele,json;if(~exports.BASEURL.indexOf(event.origin)){json=JSON.parse(event.data);if(json.height){ele=document.getElementById("clay-logout-iframe");if(ele){ele.style.height=json.height+"px"}return exports.UI.centerModal("clay-logout-wrapper")}else{exports.UI.closeModal("clay-logout-wrapper",false);local.Events.removeEvent("message",arguments.callee);local.Callbacks.execute(callbackId,[{success:true,error:false}]);_this.clearance="none";_this.installed=false;_this.identifier="no-identifier";_this.loggedIn=false;_this.data={};return localStorage.removeItem("clayLogin")}}};return local.Events.addEvent("message",listenCallback)};User.prototype.signup=function(options,callback){var callbackTmp;if(options==null){options={}}if(typeof options!=="object"){callbackTmp=callback;callback=options;options=callbackTmp||{}}options.signup=true;return this.login(options,callback)};User.prototype.sendLogin=function(json){var sendObj;if(json.identifier){this.identifier=json.identifier}if(json.hash){sendObj={fromPrompt:true,hash:json.hash,identifier:json.identifier}}else{sendObj={fromPrompt:true,username:json.name}}this.successfulJSON=json;local.Events.socketEmit("user","login",sendObj);return exports.log("Logging in...")};User.prototype.requireLogin=function(callback,reqLoggedIntoClay){var _this=this;if(callback==null){callback=false}if(reqLoggedIntoClay==null){reqLoggedIntoClay=false}if(this.loggedIn&&(!reqLoggedIntoClay||this.clearance==="clay")){return callback({success:true,error:false})}else{return this.login({signup:true,requireLogin:reqLoggedIntoClay},function(){if(_this.loggedIn&&(!reqLoggedIntoClay||_this.clearance==="clay")){return callback({success:true,error:false})}})}};return User}()});namespace("Clay",function(exports){var handler;local.Events=function(){function Events(){}Events.groups={};Events.addEvent=function(type,listener,useObject,removeListener,obj,removeGroup){var tmp,_this=this;if(useObject==null){useObject=false}if(removeListener==null){removeListener=false}if(obj==null){obj=window}if(removeGroup==null){removeGroup=false}if(removeListener||removeGroup!==false){tmp=listener;listener=function(event){var group,remove,_i,_len,_ref;remove=tmp(event);if(remove!=="skipRemoval"&&removeGroup!==false&&_this.groups[removeGroup]){_ref=_this.groups[removeGroup];for(_i=0,_len=_ref.length;_i<_len;_i++){group=_ref[_i];_this.removeEvent(group.type,group.listener,group.useObject,group.obj)}return delete _this.groups[removeGroup]}else if(remove!=="skipRemoval"&&removeListener){return _this.removeEvent(type,arguments.callee,useObject,obj)}};if(removeGroup!==false){if(!this.groups[removeGroup]){this.groups[removeGroup]=[]}this.groups[removeGroup].push({type:type,listener:listener,useObject:useObject,obj:obj})}}if(obj.addEventListener){return obj.addEventListener(type,listener,useObject)}else if(obj.attachEvent){return obj.attachEvent("on"+type,listener,useObject)}else{return obj["on"+type]=listener}};Events.removeEvent=function(type,listener,useObject,obj){if(useObject==null){useObject=false}if(obj==null){obj=window}if(obj.removeEventListener){return obj.removeEventListener(type,listener,useObject)}else if(obj.detachEvent){return obj.detachEvent("on"+type,listener,useObject)}else{return obj["on"+type]=null}};Events.triggerEvent=function(name,element){var event;if(element==null){element=window}event=void 0;if(document.createEvent){event=document.createEvent("HTMLEvents");event.initEvent(name,true,true)}else{event=document.createEventObject();event.eventType="on"+name}event.eventName=name;if(document.createEvent){return element.dispatchEvent(event)}else{return element.fireEvent(event.eventType,event)}};Events.socketListen=function(type,listener,method,removeListener){var broadcastType,handler,_this=this;if(removeListener==null){removeListener=true}if(!exports.loaded&&type!=="connect"&&type!=="error"){exports.log("Clay.io has not connected to its backend yet. Use Clay.ready() before this call, or email us if you think the issue is on our end: contact@clay.io");return}broadcastType=type;if(listener&&listener.instanceId){type+="-"+listener.instanceId}handler=function(obj){var callbackId,data;exports.log("received: "+type+(obj?" method: "+obj.method:""));if(obj&&obj.data){data=obj.data}else{data=null}if(obj&&obj.callbackId){callbackId=obj.callbackId}else{callbackId=null}if(obj&&obj.method&&typeof listener[obj.method]==="function"){if(obj.callbackId){listener[obj.method](data,callbackId)}else{listener[obj.method](data)}}else if(typeof listener==="string"){exports[listener][obj.method](data,callbackId)}else if(typeof listener==="function"){listener(data,callbackId)}if(removeListener){return _this.socketRemove(type,arguments.callee)}};local.socket.on(type,handler);if(type!==broadcastType){return local.socket.on(broadcastType,handler)}};Events.socketRemove=function(type,listener){return local.socket.removeListener(type,listener)};Events.socketEmit=function(type,method,data,instanceId,callbackId){var obj;if(method==null){method=""}if(data==null){data={}}if(instanceId==null){instanceId=false}if(callbackId==null){callbackId=false}exports.callsThisMinute++;if(exports.callsThisMinute>=local.maxCallsPerMinute){if(exports.callsThisMinute===local.maxCallsPerMinute){exports.UI.createNotification({title:"Max Calls Reached",html:"This game has reached the maximum number of calls per minute ("+local.maxCallsPerMinute+")"})}return}if(!exports.loaded){return}exports.log("sending: "+type+" instance, method: "+method+": "+instanceId);obj={method:method,data:data,callbackId:callbackId,instanceId:instanceId};return local.socket.emit(type,obj)};return Events}();handler=function(event){var json,orientation;try{json=JSON.parse(event.data)}catch(err){json=false}if(json&&json.name==="orientationchange"){window.innerHeight=parseInt(json.height);window.innerWidth=parseInt(json.width);orientation=parseInt(json.orientation);if(!isNaN(orientation)){window.orientation=orientation;exports.orientation=orientation}return local.Events.triggerEvent("orientationchange")}else if(json&&json.name==="orientation"){orientation=parseInt(json.orientation);if(!isNaN(orientation)){window.orientation=orientation;return exports.orientation=orientation}}else if(json&&json.name==="setpublisher"){return exports.publisherID=json.publisherId}};return local.Events.addEvent("message",handler)});namespace("Clay",function(exports){local.Offline=function(){function Offline(){}Offline.offline=!navigator.onLine;Offline.offlineData=localStorage.clayOfflineData?JSON.parse(localStorage.clayOfflineData):{};Offline.showWarning=function(msg){if(msg==null){msg="do that"}return Clay.UI.createNotification({title:"Must be online",html:"You must be connected to the internet to "+msg+"!"})};Offline.save=function(type,action,key,data,unique){var _base1,_base2,_base3;if(unique==null){unique=false}exports.log("Saving: "+key+" : "+data);(_base1=this.offlineData)[type]||(_base1[type]={});if(unique){(_base2=this.offlineData[type])[action]||(_base2[action]={})}else{(_base3=this.offlineData[type])[action]||(_base3[action]=[])}if(unique){this.offlineData[type][action][key]=data}else{this.offlineData[type][action].push(data)}return localStorage.clayOfflineData=JSON.stringify(this.offlineData)};Offline.fetch=function(type,action,key){if(this.offlineData[type]&&this.offlineData[type][action]&&this.offlineData[type][action][key]){return this.offlineData[type][action][key]}else{return null}};Offline.sync=function(){var data,dataItem,dataKey,key,removeData,type,typeData,_ref;if(this.offline){return}exports.log("Synchronizing Clay.io Data");_ref=this.offlineData;for(type in _ref){typeData=_ref[type];removeData=false;for(key in typeData){data=typeData[key];for(dataKey in data){dataItem=data[dataKey];if(type==="achievement"&&key==="award"){dataItem.noUI=true;removeData=true;local.Events.socketEmit("achievement","award",dataItem)}else if(type==="leaderboard"&&key==="post"){dataItem.noUI=true;removeData=true;local.Events.socketEmit("leaderboard","post",dataItem)}else if(type==="user"&&key==="saveData"){removeData=false;local.Events.socketEmit("user","userData",dataItem)}else if(type==="stats"&&key==="log"){removeData=true;local.Events.socketEmit("stats","logFromAPI",dataItem)}}if(removeData){delete this.offlineData[type]}}}return localStorage.clayOfflineData=JSON.stringify(this.offlineData)};return Offline}();exports.ready(function(){return local.Offline.sync()});return window.addEventListener("online",function(){return local.Offline.sync()})});namespace("Clay",function(exports){var checkIfReady,connect,domAndSocketLoaded,_this=this;exports.loaded=false;exports.isReady=false;exports.Player={loggedIn:false,clearance:false};checkIfReady=function(){var waitingForDOM;if(local.DOMLoaded){return domAndSocketLoaded()}else{return waitingForDOM=setInterval(function(){exports.log("waiting");if(local.DOMLoaded){clearInterval(waitingForDOM);return domAndSocketLoaded()}},50)}};connect=function(){var tries;exports.io=exports.io&&exports.io.connect?exports.io:window.clayio;exports.io=exports.io&&exports.io.connect?exports.io:window.io;clearTimeout(exports.loadTimeout);if(!Clay.SOCKET_ADDRESS){if(Clay.PROTOCOL==="https://"){Clay.SOCKET_PORT=846;Clay.SOCKET_ADDRESS=Clay.PROTOCOL+Clay.DOMAIN+":"+Clay.SOCKET_PORT}else{Clay.SOCKET_PORT=443;Clay.SOCKET_ADDRESS=Clay.PROTOCOL+"socket."+Clay.DOMAIN}}local.socket=exports.io.connect(exports.SOCKET_ADDRESS,{port:exports.SOCKET_PORT,secure:exports.PROTOCOL==="https://"});tries=0;exports.log("Connecting to socket.io");local.Events.socketListen("connect",function(){if(!exports.loaded){return checkIfReady()}else if(tries<50){if(exports.User){exports.User.tryLogin()}exports.Game.set({key:exports.gameKey,options:exports.options});return tries++}});return local.Events.socketListen("error",function(){exports.log("Could not connect to socket.io");local.Offline.offline=true;exports.loaded=true;return local.callReadies()})};domAndSocketLoaded=function(){var json;exports.loaded=true;if(exports.User){exports.Player.socketListen();if(json=localStorage.getItem("clayLogin")){json=JSON.parse(json);exports.Player.sendLogin(json);exports.Player.localStorageChecked=true}else if(exports.windows8){local.callReadies()}}return exports.Game.set({key:exports.gameKey,options:exports.options})};local.readiesCalled=false;local.callReadies=function(){var fn,_i,_len,_ref;exports.isReady=true;if(local.readiesCalled){return}local.readiesCalled=true;if(exports.readyFunction){exports.readyFunctions=[exports.readyFunction]}if(exports.readyFunctions&&exports.readyFunctions.length>0){_ref=exports.readyFunctions;for(_i=0,_len=_ref.length;_i<_len;_i++){fn=_ref[_i];if(typeof fn==="function"){fn()}}}return exports.ready=function(fn){return fn()}};local.loadSocketIO=function(){var script,tag;if(local.Offline.offline){exports.log("Offline Mode");exports.loaded=true;return local.callReadies()}else if(window.io&&window.io.connect||exports.io&&exports.io.connect){return connect()}else if(!exports.options.noExternal){script=document.createElement("script");script.type="text/javascript";exports.io={};window.socketModule={exports:exports.io};script.src=exports.BASEURL+"/api/socket.io.js";exports.log("Socket.IO Loading... ("+script.src+")");script.onreadystatechange=function(){if(this.readyState==="complete"){return connect()}};script.onload=function(){return connect()};tag=document.getElementsByTagName("script")[0];return tag.parentNode.insertBefore(script,tag)}};if(local.loadNow&&!exports.ignoreSocketIO){local.loadSocketIO()}local.platformSpecifics=function(){var userAgent;userAgent=navigator.userAgent.toLowerCase();if(window.CocoonJS){if(userAgent.indexOf("android")===-1){local.container.className="cocoonjs"}return local.container.addEventListener("click",function(event){if(event.target.tagName==="A"&&event.target.href&&event.target.href.substring(0,4)==="http"){CocoonJS.App.openURL(event.target.href);return event.preventDefault()}})}else if(userAgent.indexOf("mobile")!==-1&&userAgent.indexOf("gecko")!==-1&&userAgent.indexOf("firefox")!==-1){return local.container.className="clay-firefoxos"}};return local.ready(function(){var body,fn,json,link,tag,_i,_len,_ref;if(!local.socket&&!exports.ignoreSocketIO){exports.loadTimeout=setTimeout(function(){exports.Game.failedLoadCallback();exports.UI.createNotification({title:"Error Connecting",html:"Email Clay.io support if this message continues to occur contact@clay.io ("+exports.SOCKET_PORT+")"});return exports.ready(function(){return exports.UI.createNotification({title:"Connected",html:"Clay.io has connected!"})})},12e3)}if(exports.User){exports.Player=exports.player=new exports.User}local.container=document.createElement("div");local.container.id="clay";local.container.className="clay clay-reset";local.platformSpecifics();body=document.getElementsByTagName("body")[0];body.appendChild(local.container);body="";exports.documentReadyCheck=true;if(exports.loadFunctions&&exports.loadFunctions.length>0){_ref=exports.loadFunctions;for(_i=0,_len=_ref.length;_i<_len;_i++){fn=_ref[_i];if(typeof fn==="function"){fn()}}}exports.load=function(fn){return fn()};if(!local.loadNow){local.loadSocketIO()}if(exports.User){exports.User.tryLogin()}json={name:"orientation"};if(parent){parent.postMessage(JSON.stringify(json),"*")}if(!exports.options||!exports.options.noExternal||!exports.localCSS){link=document.createElement("link");link.rel="stylesheet";link.href=exports.BASEURL+"/api/api.css";tag=document.getElementsByTagName("script")[0];tag.parentNode.insertBefore(link,tag)}exports.callsThisMinute=0;local.maxCallsPerMinute=80;setInterval(function(){return exports.callsThisMinute=0},6e4);return local.DOMReady=true})});local.Callbacks=function(){function Callbacks(){}Callbacks.callbacks={};Callbacks.add=function(fn){var id;if(typeof fn==="function"){id=Math.random();this.callbacks[id]={fn:fn,obj:arguments.callee};return id}return false};Callbacks.execute=function(id,args){var cb;if(args==null){args=[]}if(id&&this.callbacks[id]){cb=this.callbacks[id];cb.fn.apply(cb.obj,args);return delete this.callbacks[id]}};return Callbacks}();namespace("Clay",function(exports){var _this=this;exports.UI=function(){function UI(){}UI.modalsOpened={};UI.notificationsOpened={};UI.error=function(error,id){var ele,parent,text;if(exports.options.hideUI){exports.log("Error: "+error,true);return}if(id){ele=document.getElementById(id+"-error");
if(ele){ele.innerHTML=error;ele.style.display="block"}else{ele=document.createElement("div");text=document.createTextNode(error);ele.id=id+"-error";ele.className="error";ele.appendChild(text);parent=document.getElementById(id);if(parent){parent.insertBefore(ele,parent.firstChild)}else{exports.log("Error: "+error,true)}}return setTimeout(function(){return ele.style.display="none"},3e3)}};UI.modalsOpen=function(){return local.objectLength(this.modalsOpened)};UI.notificationsOpen=function(){return local.objectLength(this.notificationsOpened)};UI.closeAllUI=function(){var id,val,_ref,_ref1,_results;_ref=this.modalsOpened;for(id in _ref){val=_ref[id];this.closeModal(id)}_ref1=this.notificationsOpened;_results=[];for(id in _ref1){val=_ref1[id];_results.push(this.closeNotification(id))}return _results};UI.closeModal=function(id,callEvent){var initialModal,modal,_this=this;if(callEvent==null){callEvent=true}if(exports.options.hideUI){return}if(!id||!(initialModal=document.getElementById(id))&&id!=="clay-login-wrapper"){initialModal=document.querySelector(".clay-modal-wrapper, .clay-custom-wrapper")}if(modal=initialModal){while(modal.parentNode&&modal.parentNode!==local.container){modal=modal.parentNode}if(callEvent){local.Events.triggerEvent("closemodal",initialModal)}}else if(!id&&local.container.getElementsByTagName("div")[0]){modal=local.container.getElementsByTagName("div")[0]}else{return}try{document.getElementById(id).parentNode.parentNode.className+=" clay-fade-out"}catch(e){}return setTimeout(function(){var ele,removed;removed=false;if(initialModal&&initialModal.parentNode&&initialModal.className==="clay-custom-wrapper"){initialModal.parentNode.removeChild(initialModal)}else if(modal&&modal.parentNode){modal.parentNode.removeChild(modal);removed=true}else{while(ele=document.getElementById(id)){try{ele.parentNode.parentNode.parentNode.removeChild(ele.parentNode.parentNode);removed=true}catch(e){}}}if(removed){delete _this.modalsOpened[id];exports.log("Modal removed ("+id+") ("+_this.modalsOpen()+")");if(window.CocoonJS&&window.CocoonJS.App){if(_this.modalsOpen()===0&&_this.notificationsOpen()===0){exports.log("Hiding CocoonJS Webview")}CocoonJS.App.forwardAsync("clay_modal_count( "+exports.UI.modalsOpen()+" );");return CocoonJS.App.hide()}}},300)};UI.getDocumentSize=function(){var D;D=document;return Math.max(Math.max(D.body.scrollHeight,D.documentElement.scrollHeight),Math.max(D.body.offsetHeight,D.documentElement.offsetHeight),Math.max(D.body.clientHeight,D.documentElement.clientHeight))};UI.getWindowSize=function(){var myHeight,myWidth;myWidth=0;myHeight=0;if(typeof window.innerWidth==="number"){myWidth=window.innerWidth;myHeight=window.innerHeight}else if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){myWidth=document.documentElement.clientWidth;myHeight=document.documentElement.clientHeight}else if(document.body&&(document.body.clientWidth||document.body.clientHeight)){myWidth=document.body.clientWidth;myHeight=document.body.clientHeight}return{height:myHeight,width:myWidth}};UI.getTabsHTML=function(tabs,id){var events,i,tab,tabsHTML,_fn,_i,_len,_this=this;tabsHTML=[];events=[];if(tabs&&tabs.length>1){tabsHTML.push("<ul class='clay-tabs'>");_fn=function(i,tab){var tabCallback,tabId;tabId=id+"-tab-"+i;tabsHTML.push("<li id='"+tabId+"'"+(tab.focused?" class='clay-tab-focus'":"")+">");tabsHTML.push("	<a href='#'>"+tab.name+"</a>");tabsHTML.push("</li>");tabCallback=function(e){var newTab,oldTab;e.preventDefault();oldTab=document.querySelector("#"+id+" .clay-tab-focus");if(oldTab){oldTab.className=""}newTab=document.getElementById(tabId);if(newTab){newTab.className="clay-tab-focus"}return tab.callback()};return events.push({id:tabId,handler:tabCallback})};for(i=_i=0,_len=tabs.length;_i<_len;i=++_i){tab=tabs[i];_fn(i,tab)}tabsHTML.push("</ul>")}return{html:tabsHTML,events:events}};UI.insertIframe=function(iframe,contentInner){var frame,listenCallback,_this=this;frame=document.createElement("iframe");local.focusedFrame=frame;frame.src=iframe.src;if(window.CocoonJS&&frame.src.indexOf("?")!==-1){frame.src+="&cocoonjs"}else if(window.CocoonJS){frame.src+="?cocoonjs"}else if(typeof process==="object"&&process.versions&&process.versions["node-webkit"]&&frame.src.indexOf("?")!==-1){frame.src+="&node-webkit"}else if(typeof process==="object"&&process.versions&&process.versions["node-webkit"]){frame.src+="?node-webkit"}frame.frameBorder="";frame.id=iframe.id;frame.className=iframe["class"];if(local.Offline.offline){contentInner.innerHTML="You must connect to the internet to do this"}else{contentInner.appendChild(frame)}listenCallback=function(event){var https,json;https="https://"+exports.DOMAIN;if(~exports.BASEURL.indexOf(event.origin)||~https.indexOf(event.origin)){json=JSON.parse(event.data);if(json.makeVisible&&contentInner){return contentInner.className=contentInner.className.replace(" clay-loading","")}}};return local.Events.addEvent("message",listenCallback)};UI.createModal=function(options,callback){var DOMid,className,debugMode,events,getTabs,html,icon,id,iframe,modalHTML,style,subnavHTML,tabs,tabsHTML,title,_this=this;if(options==null){options={}}if(callback==null){callback=false}if(exports.options.hideUI){return}title=options.title||"";html=options.html||"";id=options.id||"clay-modal-wrapper";className=options["class"]||options.id;icon=options.icon||Clay.BASEURL+"/images/logo.svg";events=options.events||[];tabs=options.tabs||null;subnavHTML=options.subnav||"powered by <a href='"+Clay.BASEURL+"' target='_blank'>clay.io</a>";iframe=options.iframe||null;debugMode=exports.options&&exports.options.debug;DOMid=options.DOMid||exports.options.DOMid;if(document.getElementById(id)){this.updateModal(options,callback);return}style="";if(options.width){if(typeof options.width==="number"){options.width+="px"}style+="max-width: "+options.width+";"}if(options.height){if(typeof options.height==="number"){options.height+="px"}style+="height:"+options.height+";"}tabsHTML=[];if(tabs&&tabs.length>1){getTabs=this.getTabsHTML(tabs,id);tabsHTML=getTabs.html;events=events.concat(getTabs.events)}modalHTML=[];if(!DOMid){modalHTML.push("<div class='clay-overlay'>");modalHTML.push("	<div class='clay-sticky-cell'>");modalHTML.push("		<div class='clay-modal-wrapper "+className+(tabs&&tabs.length?" clay-tabs-wrapper":"")+"' id='"+id+"' style='"+style+"'>");modalHTML.push("			<div id='"+id+"-tabs-wrapper'>");if(tabsHTML){modalHTML.push(tabsHTML.join(""))}modalHTML.push("			</div>");modalHTML.push("			<div class='clay-modal clearfix' id='"+id+"-inner'>");modalHTML.push("				<div id='"+id+"-header' class='clay-header'>");modalHTML.push("					<h2 class='clay-banner'>");modalHTML.push("						<img src='"+icon+"' /> ");modalHTML.push("						<span id='"+id+"-title'>"+title+"</span>");if(debugMode){modalHTML.push("						<span class='clay-debug-mode'>Debug Mode</span>")}modalHTML.push("					</h2>");modalHTML.push("					<h3 class='clay-powered-by' id='clay-powered-by'>"+subnavHTML+"</h3>");modalHTML.push("				</div>");modalHTML.push("				<a href='#' class='close' id='"+id+"-close'>&times;</a>");modalHTML.push("				<div class='clay-content-scroll-hide'>")}else{modalHTML.push("<div id='"+id+"' class='clay-custom-wrapper'>")}modalHTML.push("					<div class='clay-content' id='"+id+"-content'>");modalHTML.push("						<div class='clay-content-inner' id='"+id+"-content-inner'>");modalHTML.push(typeof html==="string"?html:html.join(""));modalHTML.push("						</div>");modalHTML.push("					</div>");if(!DOMid){modalHTML.push("				</div>");modalHTML.push("			</div>");modalHTML.push("			<div class='clay-scroll-lane'><div class='clay-scroll-drag'></div></div>");modalHTML.push("		</div>");modalHTML.push("	</div>");modalHTML.push("</div>")}else{modalHTML.push("</div>")}exports.log("Creating the modal");this.addToContainer(modalHTML,function(){var closeButton,contentInner,handler,modal,pixelRatio;if(exports.options.hideUI){return}_this.modalsOpened[id]=true;if(window.CocoonJS&&window.CocoonJS.App&&_this.modalsOpen()>=1){exports.log("Showing CocoonJS WebView (Modal ID: "+id+")");CocoonJS.App.forwardAsync("clay_modal_count( "+exports.UI.modalsOpen()+" );");pixelRatio=window.devicePixelRatio||1;CocoonJS.App.show(0,0)}contentInner=document.getElementById(id+"-content-inner");if(options.loading){contentInner.className+=" clay-loading"}handler=function(event){event.preventDefault();exports.UI.closeModal(id);return false};closeButton=document.getElementById(id+"-close");if(closeButton){local.Events.addEvent("touchstart",handler,false,false,closeButton,id);local.Events.addEvent("click",handler,false,false,closeButton,id)}if(iframe){_this.insertIframe(iframe,contentInner)}modal=document.getElementById(id);try{modal.parentNode.parentNode.className+=" clay-fade-in"}catch(e){}_this.centerModal(id);if(events&&events.length){_this.handleEvents(events)}if(callback){return callback()}},DOMid);callback=function(event){event=event||window.event;if(event.keyCode===27){return _this.closeModal(id)}else{return"skipRemoval"}};return local.Events.addEvent("keydown",callback,false,true,window,id)};UI.updateModal=function(options,callback){var contentInner,ele,events,getTabs,html,id,iframe,modal,poweredBy,src,subnavHTML,tabsHTML,tabsWrapper,title;if(options==null){options={}}if(callback==null){callback=false}if(exports.options.hideUI){return}title=options.title||"";html=options.html||"";id=options.id||"clay-modal-wrapper";subnavHTML=options.subnav||"powered by <a href='"+Clay.BASEURL+"' target='_blank'>clay.io</a>";iframe=options.iframe||null;src=options.src||null;events=options.events||[];ele=document.getElementById(id+"-title");if(ele&&title){ele.innerHTML=title}if(options.tabs&&options.tabs.length>1){getTabs=this.getTabsHTML(options.tabs,id);tabsHTML=getTabs.html;events=events.concat(getTabs.events);modal=document.getElementById(id);if(modal){modal.className+=" clay-tabs-wrapper"}tabsWrapper=document.getElementById(id+"-tabs-wrapper");tabsWrapper.innerHTML=tabsHTML.join("")}poweredBy=document.getElementById("clay-powered-by");if(poweredBy){poweredBy.innerHTML=subnavHTML}ele=document.getElementById(id+"-content-inner");if(ele){ele.innerHTML=typeof html==="string"?html:html.join("")}contentInner=document.getElementById(id+"-content-inner");if(iframe){this.insertIframe(iframe,contentInner)}if(options.loading===false){if(contentInner){contentInner.className=contentInner.className.replace(" clay-loading","")}}else if(options.loading===true){contentInner=document.getElementById(id+"-content-inner");contentInner.className+=" clay-loading"}if(callback){callback()}exports.log("Updating modal ("+this.modalsOpen()+" open)");if(events&&events.length){this.handleEvents(events)}return this.centerModal(id)};UI.centerModal=function(id){var drag,dragHeight,header,headerHeight,jumpToSpot,lane,modal,modalContent,modalInner,newHeight,paddingTop,ratio,scrollImg,scrollIndicator,tabHeight,tabs,top,windowHeight;if(exports.options.hideUI){return}modal=document.getElementById(id)||document.querySelector(".clay-modal-wrapper");if(!modal||!document.querySelector(".clay-overlay")){return}modalInner=document.getElementById(id+"-inner")||document.querySelector(".clay-modal");modalContent=document.getElementById(id+"-content")||document.querySelector(".clay-content");modal.style.height="auto";if(modalContent){modalContent.style.height="auto"}paddingTop=parseInt(modalContent.style.paddingTop)||78;paddingTop-=10;header=document.getElementById(id+"-header")||document.querySelector(".clay-header");tabs=document.querySelector(".clay-tabs");tabHeight=tabs?34:0;windowHeight=exports.UI.getWindowSize().height;document.querySelector(".clay-overlay").style.height=window.innerHeight+"px";lane=modal.querySelector(".clay-scroll-lane");if(lane){lane.style.display="none";lane.style.top=header.offsetHeight+3+"px";drag=lane.querySelector(".clay-scroll-drag")}top=(windowHeight-modal.offsetHeight-tabHeight)/2;if(top<=8){headerHeight=header.offsetHeight;newHeight=windowHeight-headerHeight-tabHeight-22+paddingTop;if(modalContent){modalContent.style.height=newHeight+"px"}}modalContent.scrollTop=0;ratio=(modalContent.offsetHeight-5-paddingTop)/modalContent.scrollHeight;if(modalContent.scrollHeight>modalContent.offsetHeight+2){lane.style.display="block";dragHeight=Math.round(ratio*modalContent.offsetHeight);drag.style.height=dragHeight+"px";if(!(scrollIndicator=document.getElementById(id+"-scroll-indicator"))){scrollIndicator=document.createElement("div");scrollIndicator.id=id+"-scroll-indicator";scrollIndicator.className="clay-scroll-indicator";scrollIndicator.onclick=function(){return modalContent.scrollTop+=50};scrollIndicator.ontouchstart=function(){return modalContent.scrollTop+=50};scrollImg=document.createElement("img");scrollImg.src=exports.BASEURL+"/images/api/down.png";scrollIndicator.appendChild(scrollImg);modalInner.appendChild(scrollIndicator)}else{scrollIndicator.style.display="block"}modalContent.className="clay-content clay-content-scroll";if(this.SCROLL_LISTENER){modalContent.removeEventListener(this.SCROLL_LISTENER)}this.SCROLL_LISTENER=modalContent.addEventListener("scroll",function(e){var scrollLeft;top=Math.round(modalContent.scrollTop*ratio);drag.style.top=top+"px";scrollLeft=Math.abs(parseInt(modalContent.scrollTop)+parseInt(modalContent.offsetHeight)-modalContent.scrollHeight);if(scrollLeft<=1&&scrollIndicator.style.display!=="none"){return scrollIndicator.style.display="none"}else if(parseInt(modalContent.scrollTop)+parseInt(modalContent.offsetHeight)<modalContent.scrollHeight&&scrollIndicator.style.display==="none"){return scrollIndicator.style.display="block"}});jumpToSpot=function(e){var h,newScrollTop,offsetY,percentageDown;e.stopPropagation();e.preventDefault();if(e.handled!==true){modalContent=modal.querySelector(".clay-content");drag=modal.querySelector(".clay-scroll-drag");h=drag.offsetHeight-paddingTop;offsetY=e.offsetY||e.layerY||e.touches[0].clientY;percentageDown=offsetY/modalContent.offsetHeight;newScrollTop=modalContent.scrollHeight*percentageDown;if(newScrollTop<modalContent.scrollTop){modalContent.scrollTop=newScrollTop+h/2}else{modalContent.scrollTop=newScrollTop-h/2}return e.handled=true}};if(this.jump1){lane.removeEventListener(this.jump1)}if(this.jump2){lane.removeEventListener(this.jump2)}this.jump1=lane.addEventListener("mousedown",jumpToSpot);return this.jump2=lane.addEventListener("touchstart",jumpToSpot)}else{modalContent.className="clay-content clay-content-no-scroll";scrollIndicator=document.getElementById(id+"-scroll-indicator");if(scrollIndicator){return scrollIndicator.style.display="none"}}};UI.scroller=null;UI.handleEvents=function(events){var ele,index,item,_results;_results=[];for(index in events){item=events[index];ele=document.getElementById(item.id);if(!ele){continue}if(item.action&&item.action!=="click"){_results.push(local.Events.addEvent(item.action,item.handler,false,false,ele))}else{local.Events.addEvent("click",item.handler,false,false,ele);_results.push(local.Events.addEvent("touchstart",item.handler,false,false,ele))}}return _results};UI.notificationId=0;UI.notificationsWrapper=false;UI.createNotification=function(options){var debugMode,delay,html,icon,id,notificationHTML,title,type,_this=this;if(options==null){options={}}if(exports.options.hideUI){return}title=options.title||"";html=options.html||"";icon=options.icon||false;type=options.type||"notification";id=options.id||exports.UI.notificationId++;delay=options.delay||3e3;debugMode=exports.options&&exports.options.debug;notificationHTML=[];notificationHTML.push("<div class='clay-notification clay-"+type+"' id='clay-"+type+"-"+id+"'>");notificationHTML.push("	<div class='clay-notification-header clay-"+type+"-header'>");notificationHTML.push(title);if(debugMode){notificationHTML.push("			<span class='clay-debug-mode'>Debug</span>")}notificationHTML.push("	</div>");notificationHTML.push("	<div class='clay-notification-content clay-"+type+"-content'>");if(icon){notificationHTML.push("		<img src='"+icon+"' class='clay-notification-icon clay-"+type+"-icon' />")}if(icon){notificationHTML.push("			<span class='clay-notification-description clay-"+type+"-description'>")}notificationHTML.push(html);if(icon){notificationHTML.push("			</span>")}notificationHTML.push("		</div>");notificationHTML.push("<a href='#' id='clay-"+type+"-"+id+"-close' class='clay-notification-close clay-"+type+"-close'>&times;</a>");notificationHTML.push("</div>");if(!this.notificationsWrapper){this.notificationsWrapper=document.createElement("div");this.notificationsWrapper.id="clay-notifications-wrapper";this.notificationsWrapper.className="clay-notifications-wrapper";local.container.appendChild(this.notificationsWrapper)}this.addToContainer(notificationHTML,function(){var ele,pixelRatio;ele=document.getElementById("clay-"+type+"-"+id+"-close");if(ele){ele.onclick=function(){exports.UI.closeNotification("clay-"+type+"-"+id);return false}}ele=document.getElementById("clay-"+type+"-"+id);try{ele.className+=" clay-fade-in"}catch(e){}_this.notificationsOpened["clay-"+type+"-"+id]=true;if(window.CocoonJS&&window.CocoonJS.App&&_this.notificationsOpen()>=1&&_this.modalsOpen()===0){exports.log("Showing CocoonJS WebView");pixelRatio=window.devicePixelRatio||1;return CocoonJS.App.show((window.innerWidth-300)*pixelRatio,0,300*pixelRatio,120*pixelRatio)}},this.notificationsWrapper);if(exports.player.clearance!=="clay"&&type==="achievement"){delay=5e3}if(delay>0){return setTimeout(function(){return _this.closeNotification("clay-"+type+"-"+id)},delay)}};UI.createShareMessage=function(options){var debugMode,delay,html,icon,id,notificationHTML,title,type,_this=this;if(options==null){options={}}if(exports.options.hideUI){return}title=options.title||"";html=options.html||"";icon=options.icon||false;type=options.type||"notification";id=options.id||exports.UI.notificationId++;delay=options.delay||3e3;debugMode=exports.options&&exports.options.debug;notificationHTML=[];notificationHTML.push("<div class='clay-webview-share-overlay' id='clay-"+type+"-"+id+"-wrapper'>");notificationHTML.push(" <div class='clay-webview-share' id='clay-"+type+"-"+id+"'>");notificationHTML.push("		<div class='clay-notification-header clay-"+type+"-header'>");notificationHTML.push(title);if(debugMode){notificationHTML.push("			<span class='clay-debug-mode'>Debug</span>")}notificationHTML.push("		</div>");notificationHTML.push("		<div class='clay-notification-content clay-"+type+"-content'>");if(icon){notificationHTML.push("			<img src='"+icon+"' class='clay-notification-icon clay-"+type+"-icon' />")}if(icon){notificationHTML.push("			<span class='clay-notification-description clay-"+type+"-description'>")}notificationHTML.push(html);if(icon){notificationHTML.push("			</span>")}notificationHTML.push("		</div>");notificationHTML.push("		<a href='#' id='clay-"+type+"-"+id+"-close' class='clay-notification-close clay-"+type+"-close'>&times;</a>");notificationHTML.push("	</div>");notificationHTML.push("</div>");return this.addToContainer(notificationHTML,function(){var ele;ele=document.getElementById("clay-"+type+"-"+id+"-close");if(ele){ele.onclick=function(){exports.UI.closeNotification("clay-"+type+"-"+id+"-wrapper");return false}}ele=document.getElementById("clay-"+type+"-"+id);try{return ele.className+=" clay-fade-in"}catch(e){}})};UI.closeNotification=function(id){var ele,_this=this;if(id==null){id="0"}if(exports.options.hideUI){return}ele=document.getElementById(id);if(ele){delete this.notificationsOpened[id]}if(window.CocoonJS&&window.CocoonJS.App&&this.modalsOpen()===0&&this.notificationsOpen()===0){exports.log("Hiding CocoonJS Webview");CocoonJS.App.hide()}try{document.getElementById(id).className+=" clay-fade-out"}catch(e){}return setTimeout(function(){return _this.removeElement(id)},300)};UI.showPopupNotifier=function(site){return exports.UI.createNotification({id:"popup-"+site,delay:"0",title:"Popup Blocker",html:"We're opening a window to "+site+". Be sure your popup blocker allows popups from Clay.io"})};UI.hidePopupNotifier=function(site){return exports.UI.closeNotification("clay-notification-popup-"+site)};UI.addToContainer=function(html,callback,DOMelement){var ele,wrapperDiv;if(callback==null){callback=false}if(DOMelement==null){DOMelement=false}if(exports.options.hideUI){return}wrapperDiv=document.createElement("div");wrapperDiv.className="clay";if(typeof html==="object"&&Object.prototype.toString.call(html)!=="[object Array]"){wrapperDiv.appendChild(html)}else{wrapperDiv.innerHTML+=typeof html==="string"?html:html.join("")}if(DOMelement&&typeof DOMelement==="string"&&(ele=document.getElementById(DOMelement))){ele.appendChild(wrapperDiv)}else if(DOMelement){DOMelement.appendChild(wrapperDiv)}else{local.container.appendChild(wrapperDiv)}if(callback){return callback()}};UI.removeElement=function(element){if(exports.options.hideUI){return}if(typeof element==="string"){element=document.getElementById(element)}try{if(element&&element.parentNode){return element.parentNode.removeChild(element)}}catch(err){}};return UI}();return local.Events.addEvent("resize",function(){var id,val,_ref,_results;_ref=exports.UI.modalsOpened;_results=[];for(id in _ref){val=_ref[id];_results.push(exports.UI.centerModal(id))}return _results})});namespace("Clay",function(exports){return exports.Tools=function(){function Tools(){}Tools.broadcast=function(message){return local.Events.socketEmit("broadcast","send",message)};return Tools}()});namespace("Clay",function(exports){return exports.Stats=function(){function Stats(){}Stats.log=function(options){var obj,quantity,type;type=options.name;quantity=options.quantity||1;obj={type:type,quantity:quantity};if(local.Offline.offline){return local.Offline.save("stats","log",null,obj,false)}else{return local.Events.socketEmit("stats","logFromAPI",obj,1)}};Stats.logStat=function(options){return this.log(options)};Stats.level=function(options){return local.Events.socketEmit("stats","level",options,1)};return Stats}()});namespace("Clay",function(exports){return exports.Links=function(){function Links(){}Links.create=function(options,callback){var callbackId;if(options==null){options={}}if(callback==null){callback=false}if(callback){callbackId=local.Callbacks.add(callback)}local.Events.socketListen("links","Links",null,true);return local.Events.socketEmit("links","create",options,null,callbackId)};Links.createCallback=function(obj,callbackId){if(callbackId==null){callbackId=false}if(obj.updateCurrent){if(history&&history.pushState){history.pushState({module:"leave"},document.title,"#"+obj.hash)}else{window.location.hash=obj.hash}}obj.url=window.location.origin+window.location.pathname+"#"+obj.hash;if(callbackId){return local.Callbacks.execute(callbackId,[obj])}};Links.processHash=function(obj){if(obj==null){obj={}}if(obj.type==="data"||obj.type==="challenge"){this.data=obj.data;if(this.dataCallback){this.dataCallback(this.data)}}else if(obj.type==="room"){this.rooms=new Clay.Rooms;this.rooms.joinRoom({id:obj.roomId})}if(obj.type==="challenge"){this.displayChallenge();return exports.Leaderboard.challenge=this.data}};Links.displayChallenge=function(){var events,html,options,title;html=[];html.push("<div class='clay-challenge-text'><strong>"+this.data.name+"</strong> challenged you to beat their score of: </div>");html.push("<h1 class='clay-challenge-score'>"+this.data.score+"</h1>");html.push("<div class='clay-challenge-text'>Think you have what it takes?</div>");html.push("<div><a href='#' class='clay-button' id='clay-challenge-play-button'>Play "+Clay.Game.data.name+"</a></div>");events=[];events.push({id:"clay-challenge-play-button",handler:function(){return exports.UI.closeModal("clay-challenge-wrapper")}});title="You've Been Challenged!";options={id:"clay-challenge-wrapper",title:title,html:html,events:events};return exports.UI.createModal(options)};Links.prototype.data=null;Links.prototype.dataCallback=null;Links.getData=function(callback){if(callback==null){callback=false}if(this.data!==null&&callback){callback(exports.Links.data)}else if(callback){this.dataCallback=callback}return this.data};Links.getChallenge=function(callback){if(callback==null){callback=false}return this.getData(callback)};Links.share=function(){};return Links}()});namespace("Clay",function(exports){return exports.Messages=function(){function Messages(){}Messages.listening=false;Messages.listen=function(){if(!this.listening){local.Events.socketListen("messages","Messages",false,false);return this.listening=true}};Messages.modalOpen=function(){return!!document.getElementById("clay-messages-wrapper")};Messages.compose=function(options,callback){var events,html,message,modalOptions,onClick,_this=this;if(options==null){options={}}if(callback==null){callback=false}html=[];events=[];html.push("<div class='clay-message-compose'>");html.push("	<div class='clay-message-compose-to'><label for='clay-message-to'>To: </label>");if(options.to){html.push(options.to)}else{html.push("		<input type='text' id='clay-message-to' class='inline default-input' placeholder='Enter a username...' />")}html.push("</div>");html.push("	<div class='clay-message-compose-subject'><label for='clay-message-subject'>Subject: </label>");html.push("		<input type='text' id='clay-message-subject' class='inline default-input' placeholder='Enter a subject...' />");html.push("</div>");message=options.message||"";html.push("	<textarea id='clay-message-compose-text' placeholder='Enter a message...'>"+message+"</textarea>");html.push("	<input type='submit' id='clay-message-compose-button' />");onClick=function(e){var subject,subjectEle,textarea,to,toEle;e.preventDefault();textarea=document.getElementById("clay-message-compose-text");message=textarea.value;textarea.value="";toEle=document.getElementById("clay-message-to");to=toEle?toEle.value:options.to;subjectEle=document.getElementById("clay-message-subject");subject=subjectEle?subjectEle.value:options.subject;if(textarea){return _this.send({to:to,subject:subject,message:message})}};events.push({id:"clay-message-compose-button",handler:onClick});modalOptions={title:"Compose a Message",html:html,id:"clay-messages-wrapper",events:events};if(!this.modalOpen()){modalOptions.tabs=this.getTabs("compose")}if(options.DOMid){modalOptions.DOMid=options.DOMid}return exports.UI.createModal(modalOptions)};Messages.send=function(options,callback){var callbackId,ele;if(callback==null){callback=false}if(!options.message){return}ele=document.getElementById("clay-messages");if(ele){ele.innerHTML=this.displayMessage({message:options.message,from_id:exports.Player.data.id})+ele.innerHTML}if(callback){callbackId=local.Callbacks.add(callback)}this.listen();return local.Events.socketEmit("messages","send",options,null,callbackId)};Messages.sendCallback=function(obj,callbackId){if(callbackId==null){callbackId=false}if(!obj.reply){return this.show({id:obj.id})}};Messages.getTabs=function(currentTab){var html,onClick,tabs,_this=this;html=[];tabs=[];onClick=function(){return _this.showAll()};tabs.push({name:"Inbox",focused:currentTab==="inbox",callback:onClick});onClick=function(){return _this.compose()};tabs.push({name:"Compose",focused:currentTab==="compose",callback:onClick});return tabs};Messages.show=function(options,callback){var callbackId;if(callback==null){callback=false}if(callback){callbackId=local.Callbacks.add(callback)}this.listen();return local.Events.socketEmit("messages","show",options,null,callbackId)};Messages.showCallback=function(obj,callbackId){var events,html,message,messages,onClick,options,_i,_len,_this=this;if(callbackId==null){callbackId=false}html=[];events=[];messages=obj.data;if(!messages.length){html.push("Thread not found!")}else{html.push("<a href='#' id='clay-message-inbox-link'>&laquo; Inbox</a>");onClick=function(e){e.preventDefault();return _this.showAll()};events.push({id:"clay-message-inbox-link",handler:onClick});html.push("<div class='clay-message-reply'>");html.push("	<textarea id='clay-message-reply-text' placeholder='Enter a message...'></textarea>");html.push("	<input type='submit' id='clay-message-reply-button' />");onClick=function(e){var message,textarea;e.preventDefault();textarea=document.getElementById("clay-message-reply-text");message=textarea.value;textarea.value="";if(textarea){return _this.send({to:messages[0].from_id,message:message,threadId:messages[0].thread_id,reply:true})}};events.push({id:"clay-message-reply-button",handler:onClick});html.push("</div>");html.push("<div class='clay-message-subject'>");html.push(messages[0].subject);html.push("</div>");html.push("<div id='clay-messages'>");for(_i=0,_len=messages.length;_i<_len;_i++){message=messages[_i];html.push(this.displayMessage(message))}html.push("</div>")}options={title:"View Message",html:html,id:"clay-messages-wrapper",events:events};if(!this.modalOpen()){options.tabs=this.getTabs("inbox")}if(obj.DOMid){options.DOMid=obj.DOMid}return exports.UI.createModal(options)};Messages.displayMessage=function(message,justNow){var html;if(justNow==null){justNow=false}html=[];html.push("<div class='clay-message'>");html.push("	<div class='clay-message-header'>");html.push("		<img src='"+exports.BASEURL+"/avatar/"+message.from_id+"/20' /> ");html.push("		Sent by "+(message.other_username?message.other_username:"you")+" ");if(typeof message.time==="undefined"){html.push("		just now")}else{html.push(local.formatTime(message.time))}html.push("	</div>");html.push("	<div class='clay-message-message'>");html.push(message.message.replace("\n","<br />"));html.push("	</div>");html.push("</div>");return html.join("")};Messages.showAll=function(options,callback){var callbackId;if(callback==null){callback=false}if(callback){callbackId=local.Callbacks.add(callback)}this.listen();return local.Events.socketEmit("messages","showAll",options,null,callbackId)};Messages.showAllCallback=function(obj,callbackId){var events,html,message,messages,options,_fn,_i,_len,_this=this;if(callbackId==null){callbackId=false}html=[];events=[];messages=obj.data;if(!messages||!messages.length){html.push("You do not have any messages!")}_fn=function(message){var messageClick;html.push("<div class='clay-message-thread' id='clay-message-thread-"+message.thread_id+"'>");html.push("	<div class='clay-message-thread-icon'>");html.push("		<img src='"+exports.BASEURL+"/avatar/"+message.other_id+"/40' />");html.push("	</div>");html.push("	<div class='clay-message-header'>");html.push("		Sent by "+(message.other_username?message.other_username:"you")+" ");if(typeof message.time==="undefined"){html.push("		just now")}else{html.push(local.formatTime(message.time))}html.push("	</div>");html.push("	<div class='clay-message-thread-subject'>");html.push(message.subject);html.push("	</div>");html.push("	<div class='clay-message-thread-body'>");html.push(message.message.length>200?message.message.substring(0,200)+"...":message.message);html.push("	</div>");html.push("</div>");messageClick=function(){return _this.show({threadId:message.thread_id})};return events.push({id:"clay-message-thread-"+message.thread_id,action:"click",handler:messageClick})};for(_i=0,_len=messages.length;_i<_len;_i++){message=messages[_i];_fn(message)}options={title:"Messages",html:html,id:"clay-messages-wrapper",events:events};if(!this.modalOpen()){options.tabs=this.getTabs("inbox")}if(obj.DOMid){options.DOMid=obj.DOMid}exports.UI.createModal(options);if(callbackId){return local.Callbacks.execute(callbackId,[obj])}};return Messages}()});namespace("Clay",function(exports){return exports.Payment=function(){function Payment(){this.items={};this.itemCallback=[];this.instanceId=Math.random();if(!local.Offline.offline){local.Events.socketListen("payment",this,null,false)}}Payment.prototype.addItem=function(options,callback){var callbackId,id,type;if(callback==null){callback=false}if(local.Offline.offline){local.Offline.showWarning("purchase an item");return}if(typeof options!=="object"){options={id:options,type:"item"};
exports.log("This form of passing item ID is deprecated")}id=options.id;type=options.type;type||(type="item");if(this.items[id]){this.items[id].quantity++;if(callback){return callback(this.items[id].data)}}else{callbackId=local.Callbacks.add(callback);return local.Events.socketEmit("payment","addItem",options,this.instanceId,callbackId)}};Payment.prototype.addCustomItem=function(obj,callback){var type;if(callback==null){callback=false}type=obj.type||"custom";this.items[obj.id]={type:type,quantity:1,data:obj};if(callback){return callback()}};Payment.prototype.addItemStore=function(obj,callbackId){if(callbackId==null){callbackId=false}if(obj.success){this.items[obj.id]={type:obj.type||"item",quantity:1,data:obj}}if(callbackId){return local.Callbacks.execute(callbackId,[obj])}};Payment.prototype.getItemIds=function(){var i,id,ids,item,_i,_ref,_ref1;ids=[];_ref=this.items;for(id in _ref){item=_ref[id];for(i=_i=1,_ref1=item.quantity;1<=_ref1?_i<=_ref1:_i>=_ref1;i=1<=_ref1?++_i:--_i){ids.push(item.type+"_"+id)}}return ids};Payment.prototype.getItemsForURL=function(){var i,id,item,items,_i,_ref,_ref1;items=[];_ref=this.items;for(id in _ref){item=_ref[id];for(i=_i=1,_ref1=item.quantity;1<=_ref1?_i<=_ref1:_i>=_ref1;i=1<=_ref1?++_i:--_i){if(item.data&&item.data.data){items.push({type:item.type,data:item.data.data})}else if(item.data&&item.data.id){items.push({type:item.type,id:item.data.id})}}}return encodeURIComponent(JSON.stringify(items))};Payment.prototype.removeItem=function(options){if(typeof options!=="object"){options={id:options};exports.log("This form of passing item ID is deprecated")}if(this.items[options.id]&&this.items[options.id].quantity>1){this.items[options.id].quantity--;return document.getElementById("clay-item-quantity-"+options.id).innerHTML=this.items[options.id].quantity}else{delete this.items[options.id];return exports.UI.removeElement(document.getElementById("clay-item-"+options.id))}};Payment.prototype.checkout=function(options,callback){var events,id,item,modalOptions,onSubmit,paymentHTML,_fn,_ref,_ref1,_this=this;if(options==null){options={}}if(local.Offline.offline){local.Offline.showWarning("purchase an item");return}_this=this;if(typeof options!=="object"){callback=options}events=[];paymentHTML=[];paymentHTML.push("<table>");paymentHTML.push("	<thead>");paymentHTML.push("		<tr>");paymentHTML.push("			<th class='th-item-name'>Item Name</th>");paymentHTML.push("			<th class='th-quantity'>Quantity</th>");paymentHTML.push("			<th class='th-item-price'>Item Price</th>");paymentHTML.push("			<th class='th-remove'>Remove</th>");paymentHTML.push("		</tr>");paymentHTML.push("	</thead>");paymentHTML.push("	<tbody>");_ref=this.items;for(id in _ref){item=_ref[id];paymentHTML.push("	<tr id='clay-item-"+id+"'>");paymentHTML.push("		<td>"+item.data.name+"</td>");paymentHTML.push("		<td id='clay-item-quantity-"+id+"'>"+item.quantity+"</td>");paymentHTML.push("		<td id='clay-item-quantity-"+id+"'>$"+item.data.price+"</td>");paymentHTML.push("		<td><a href='#' id='clay-remove-link-"+id+"'>&times;</a></td>");paymentHTML.push("	</tr>")}paymentHTML.push("	</tbody>");paymentHTML.push("</table>");paymentHTML.push("<input type='submit' id='clay-submit-button' value='Checkout'></span>");onSubmit=function(){return _this.pay(callback)};events.push({id:"clay-submit-button",handler:onSubmit});_ref1=this.items;_fn=function(id){var onClick;onClick=function(){_this.removeItem(id);return false};return events.push({id:"clay-remove-link-"+id,handler:onClick})};for(id in _ref1){item=_ref1[id];_fn(id)}modalOptions={title:"Purchase",html:paymentHTML,id:"clay-payment-wrapper",events:events,DOMid:options.id};return exports.UI.createModal(modalOptions)};Payment.prototype.pay=function(callback){var _this;_this=this;return exports.player.requireLogin(function(){var debug,iframe,listenCallback,options,paymentHTML,wrapper;wrapper=document.getElementById("clay-payment-wrapper");if(wrapper){wrapper.style.maxWidth="339px"}paymentHTML=[];debug=exports.options&&exports.options.debug?"&debug":"";iframe={src:Clay.BASEURL+"/api/payment/?items="+_this.getItemsForURL()+"&game_id="+Clay.gameID+debug,id:"clay-payment-iframe"};options={title:"Purchase",html:paymentHTML,iframe:iframe,id:"clay-payment-wrapper",loading:true,src:Clay.BASEURL+"/images/api/clay_shopping_cart.png"};exports.UI.updateModal(options);listenCallback=function(event){var json;if(~exports.BASEURL.indexOf(event.origin)){json=JSON.parse(event.data);if(json.height){document.getElementById("clay-payment-iframe").style.height=json.height+"px";document.getElementById("clay-payment-iframe").style.width=json.width+"px";if(wrapper){wrapper.style.maxWidth=parseInt(json.width)+30+"px"}return exports.UI.centerModal("clay-payment-wrapper")}else if(json.popup){return exports.UI.showPopupNotifier(json.popup)}else if(json.popupClose){return exports.UI.hidePopupNotifier(json.popupClose)}else if(json.backToCart){wrapper=document.getElementById("clay-payment-wrapper");if(wrapper){wrapper.style.maxWidth=null}return _this.checkout()}else{_this.paymentCallback(json,callback);return local.Events.removeEvent("message",arguments.callee)}}};return local.Events.addEvent("message",listenCallback)},true)};Payment.prototype.paymentCallback=function(json,callback){exports.UI.closeModal("clay-payment-wrapper");if(callback){callback(json)}return local.Events.socketEmit("payment","complete",json)};return Payment}()});namespace("Clay",function(exports){return exports.Broadcast=function(){function Broadcast(){var _this;_this=this;local.Events.socketListen("broadcast",this)}Broadcast.prototype.show=function(message){var broadcast;broadcast=[];broadcast.push("<div class='clay-achievement'>");broadcast.push("<a href='javascript: void( 0 );' onclick='Clay.closeModal();' class='close'>&times;</a>");broadcast.push(message);broadcast.push("</div>");return exports.modal.innerHTML=broadcast.join("")};return Broadcast}()});namespace("Clay",function(exports){return exports.Ratings=function(){function Ratings(options){var ele,listenCallback,modalOptions,rateHTML;if(options==null){options={}}if(local.Offline.offline){local.Offline.showWarning("rate a game");return}rateHTML=[];rateHTML.push("<iframe src='"+exports.BASEURL+"/api/rate/?id="+exports.gameID+"' id='clay-rate-iframe' frameBorder='0'></iframe>");modalOptions={title:"Rate this Game",html:rateHTML,id:"clay-rate-wrapper"};if(options.id&&(ele=document.getElementById(options.id))){ele.innerHTML=html.join("")}else{exports.UI.createModal(modalOptions)}listenCallback=function(event){var json;if(~exports.BASEURL.indexOf(event.origin)){json=JSON.parse(event.data);if(json.height){ele=document.getElementById("clay-rate-iframe");ele.height=json.height;ele.style.height=json.height+"px";return exports.UI.centerModal("clay-rate-wrapper")}}};local.Events.addEvent("message",listenCallback)}return Ratings}()});namespace("Clay",function(exports){return exports.Suggestions=function(){function Suggestions(options,callback){var ele,html,listenCallback,modalOptions;if(options==null){options={}}if(local.Offline.offline){return}html=[];html.push("<iframe src='"+Clay.BASEURL+"/api/suggestions/?id="+exports.gameID+"' id='clay-suggestions-iframe' frameBorder='0'></iframe>");modalOptions={title:"Game Suggestions",html:html,id:"clay-suggestions-wrapper"};if(options.id&&(ele=document.getElementById(options.id))){ele.innerHTML=html.join("")}else{exports.UI.createModal(modalOptions)}listenCallback=function(event){var json;if(~exports.BASEURL.indexOf(event.origin)){json=JSON.parse(event.data);if(json.height){document.getElementById("clay-suggestions-iframe").height=json.height;return exports.UI.centerModal("clay-suggestions-wrapper")}}};local.Events.addEvent("message",listenCallback)}return Suggestions}()});namespace("Clay",function(exports){return exports.Game=function(){function Game(){}Game.listening=false;Game.data={};Game.set=function(options,callback){var callbackId;if(options==null){options={}}if(callback==null){callback=false}if(!this.listening){local.Events.socketListen("game","Game",null,false);this.listening=true}if(window&&window.location&&window.location.hash){options.hash=window.location.hash.replace("#","");local.Events.socketListen("links","Links",null,true)}exports.gameKey=options.key;options.referrer=window.location!==window.parent.location?document.referrer:document.location.href;if(!options.referrer||window.CocoonJS){if(navigator.userAgent.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i)){options.referrer="ios"}if(navigator.userAgent.match(/(Android)/i)){options.referrer="android"}}if(callback){callbackId=local.Callbacks.add(callback)}return local.Events.socketEmit("game","set",options,null,callbackId)};Game.store=function(obj,callbackId){var style,tag;if(callbackId==null){callbackId=false}this.data=obj;exports.gameID=obj.id;local.curTime=obj.serverTime;if(obj.css&&(!exports.options||!exports.options.noExternal)){style=document.createElement("style");style.appendChild(document.createTextNode(obj.css));tag=document.getElementsByTagName("script")[0];tag.parentNode.insertBefore(style,tag)}if(exports.options.noExternal&&obj.showLogin&&!exports.Player.loggedIn&&local.windowsRequestLogin){exports.Player.login()}if(callbackId){local.Callbacks.execute(callbackId,[obj])}return this.checkForUpdates(obj.lastUpdate)};Game.checkForUpdates=function(lastUpdate){var localLastUpdate;localLastUpdate=local.Offline.fetch("game","storage","lastUpdate");if(localLastUpdate<lastUpdate){return local.Events.socketEmit("game","checkUpdates")}};Game.checkForUpdatesCallback=function(obj){local.Offline.set("game","storage","lastUpdate",obj.lastUpdate,true);return local.Offline.set("achievements","all","all",obj.achievemens,true)};Game.failedLoadCallback=function(){if(exports.options&&exports.options.fail){return exports.options.fail()}};Game.error=function(error){return exports.UI.error(error)};return Game}()});namespace("Clay",function(exports){return exports.Rooms=function(){function Rooms(options){var callback,callbackId;if(options==null){options={}}if(typeof options==="function"){this.fullCallback=options}else{this.fullCallback=options.fullCallback;callback=options.callback}this.instanceId=Math.random();this.rooms={};this.room=false;this.roomsLoaded=false;local.Events.socketListen("rooms",this,null,false);if(callback){callbackId=local.Callbacks.add(callback)}local.Events.socketEmit("rooms","fetch",{show:false},this.instanceId,callbackId)}Rooms.prototype.setFullCallback=function(fullCallback){this.fullCallback=fullCallback};Rooms.prototype.show=function(callback){var callbackId;callbackId=local.Callbacks.add(callback);return local.Events.socketEmit("rooms","fetch",{show:true},this.instanceId,callbackId)};Rooms.prototype.fetchCallback=function(obj,callbackId){var events,header,html,id,onSubmit,options,room,_i,_len,_ref,_ref1,_ref2,_this=this;_this=this;this.rooms=obj.rooms||{};this.roomsLoaded=true;if(obj.show){html=[];html.push("<table>");html.push("<thead>");_ref=obj.header;for(_i=0,_len=_ref.length;_i<_len;_i++){header=_ref[_i];html.push("<th>"+header+"</th>")}html.push("<tbody id='clay-rooms'>");_ref1=obj.rooms;for(id in _ref1){room=_ref1[id];if(room){html.push("<tr id='clay-room-"+id+"'>");html.push(this.getRoomTd(room,false,false,true));html.push("</tr>")}}html.push("</tbody>");html.push("</table>");html.push("<span id='clay-room-add'>");html.push("	<input type='text' id='clay-room-name' placeholder='New Room Name' /> <input type='submit' value='Create Room' id='clay-create-room-button' />");html.push("</span>");events=[];_ref2=obj.rooms;for(id in _ref2){room=_ref2[id];if(room&&room.count<room.max){(function(id){var onClick;onClick=function(){_this.joinRoom(id);return false};return events.push({id:"clay-join-"+id+"-link",handler:onClick})})(id)}}onSubmit=function(){return _this.createRoom()};events.push({id:"clay-create-room-button",handler:onSubmit});options={title:"Rooms",html:html,id:"clay-rooms-wrapper",events:events};exports.UI.createModal(options)}return local.Callbacks.execute(callbackId,[this.rooms])};Rooms.prototype.getRooms=function(){return this.rooms};Rooms.prototype.createRoom=function(options,callback){var callbackId,ele;if(options==null){options={}}if(callback==null){callback=false}if(callback){callbackId=local.Callbacks.add(callback)}ele=document.getElementById("clay-room-name");if(ele){options.name||(options.name=ele.value)}return local.Events.socketEmit("rooms","createRoom",{name:options.name},this.instanceId,callbackId)};Rooms.prototype.createRoomCallback=function(obj,callbackId){var roomAdd,row,table;exports.log(obj);if(obj.success){table=document.getElementById("clay-rooms");row=this.getRoomTd(obj,true);if(table&&row){table.appendChild(row)}roomAdd=document.getElementById("clay-room-add");if(roomAdd){roomAdd.innerHTML="Room created, waiting for more players..."}this.room=obj.id;this.rooms[obj.id]={name:obj.name,count:obj.count};if(this.rooms[obj.id].count>=obj.max){this.roomFull(obj)}}if(callbackId){return local.Callbacks.execute(callbackId,[this.rooms[obj.id]])}};Rooms.prototype.getRoomTd=function(obj,inRoom,tr,returnHTML){var a,html,td,text;if(inRoom==null){inRoom=false}if(tr==null){tr=false}if(returnHTML==null){returnHTML=false}if(returnHTML){html=[];html.push("<td>"+obj.name+"</td>");html.push("<td>"+obj.count+"</td>");html.push("<td id='clay-join-"+obj.id+"-link-wrapper'>"+(inRoom?"In Room":obj.count>=obj.max?"Room Full":"<a href='#' id='clay-join-"+obj.id+"-link'>Join Room</a>")+"</td>");return html.join("")}else{if(!tr){tr=document.createElement("tr");tr.id="clay-room-"+obj.id}else{tr.innerHTML=""}td=document.createElement("td");text=document.createTextNode(obj.name);td.appendChild(text);tr.appendChild(td);td=document.createElement("td");text=document.createTextNode(obj.count);td.appendChild(text);tr.appendChild(td);td=document.createElement("td");td.id="clay-join-"+obj.id+"-link-wrapper";if(inRoom){text=document.createTextNode("In Room");td.appendChild(text)}else if(obj.count>=obj.max){text=document.createTextNode("Room Full");td.appendChild(text)}else{a=document.createElement("a");a.id="clay-join-"+obj.id+"-link";text=document.createTextNode("Room Full");a.appendChild(text);td.appendChild(a)}tr.appendChild(td);return tr}};Rooms.prototype.joinRoom=function(options,callback){var callbackId;if(callback==null){callback=false}if(typeof options!=="object"){options={id:options};exports.log("This form of passing item ID is deprecated")}if(callback){callbackId=local.Callbacks.add(callback)}return local.Events.socketEmit("rooms","joinRoom",options,this.instanceId,callbackId)};Rooms.prototype.joinRoomCallback=function(obj,callbackId){exports.log(obj);if(obj.success){this.room=obj.id;this.rooms[obj.id].count++;this.refreshTd(obj.id,true);if(this.rooms[obj.id].count>=obj.max){this.roomFull(obj)}}else{exports.UI.error(obj.error,"clay-rooms-wrapper-content")}if(callbackId){return local.Callbacks.execute(callbackId,[this.rooms[obj.id]])}};Rooms.prototype.leaveRoom=function(callback){var callbackId;if(callback==null){callback=false}if(callback){callbackId=local.Callbacks.add(callback)}return local.Events.socketEmit("rooms","leaveRoom",{},this.instanceId,callbackId)};Rooms.prototype.leaveRoomCallback=function(obj,callbackId){if(callbackId){return local.Callbacks.execute(callbackId)}};Rooms.prototype.refresh=function(obj){this.rooms[obj.id]={name:obj.name,count:obj.count};this.refreshTd(obj.id);if(obj.count>=obj.max){return this.roomFull(obj)}};Rooms.prototype.roomFull=function(obj){if(this.room===obj.id){obj.instance=this;if(this.fullCallback){this.fullCallback(obj)}exports.UI.closeModal("clay-rooms-wrapper")}exports.UI.removeElement(document.getElementById("clay-room-"+obj.id));return delete this.rooms[obj.id]};Rooms.prototype.refreshTd=function(id,inRoom){var ele,events,onClick,room,roomsTable,_this=this;if(inRoom==null){inRoom=false}room=this.rooms[id];room.id=id;ele=document.getElementById("clay-room-"+id);if(ele&&room.count>0){this.getRoomTd(room,inRoom,ele)}else if(ele){exports.UI.removeElement(ele)}else{roomsTable=document.getElementById("clay-rooms");if(roomsTable){roomsTable.appendChild(this.getRoomTd(room,inRoom))}}if(!inRoom){onClick=function(){_this.joinRoom({id:id});return false};events=[];ele=document.getElementById("clay-join-"+id+"-link-wrapper");if(ele){ele.innerHTML="<a href='#' id='clay-join-"+id+"-link'>Join Room</a>"}events.push({id:"clay-join-"+id+"-link",handler:onClick});return exports.UI.handleEvents(events)}};return Rooms}()});namespace("Clay",function(exports){return exports.Screenshot=function(){function Screenshot(options,callback){if(callback==null){callback=false}if(options){this.id=options.id||false}else{this.id=false}if(typeof options==="undefined"||typeof options.prompt==="undefined"||options.prompt){this.prompt(callback)}this.instanceId=Math.random();local.Events.socketListen("screenshot",this,null,false)}Screenshot.prototype.prompt=function(callback){var callbackFn,canvas,events,modalHTML,onClick,options,_this=this;modalHTML=[];events=[];if(this.id){canvas=document.getElementById(this.id)}else{canvas=document.getElementsByTagName("canvas")[0]}if(canvas&&!this.data){this.data=canvas.toDataURL("image/png")}modalHTML.push("<img class='clay-screenshot' src='"+this.data+"' height='200' />");modalHTML.push("<div><input type='submit' value='save' id='clay-screenshot-save-"+this.instanceId+"' /></div>");callbackFn=function(response){if(callback){callback(response)}return exports.UI.closeModal("clay-screenshot-wrapper")};onClick=function(){return _this.save(callbackFn)};events.push({id:"clay-screenshot-save-"+this.instanceId,handler:onClick});options={title:"Screenshot",html:modalHTML,id:"clay-screenshot-wrapper",events:events};return exports.UI.createModal(options)};Screenshot.prototype.save=function(options,callback){var canvas,_this=this;if(options==null){options={}}if(callback==null){callback=false}if(typeof options!=="object"){callback=options;options={}}if(this.id){canvas=document.getElementById(this.id)}else{canvas=document.getElementsByTagName("canvas")[0]}if(!this.data){this.data=canvas.toDataURL("image/png")}options.data=this.data;return exports.player.requireLogin(function(){var callbackId;if(callback){callbackId=local.Callbacks.add(callback)}return local.Events.socketEmit("screenshot","save",options,_this.instanceId,callbackId)},true)};Screenshot.prototype.saveCallback=function(obj,callbackId){if(callbackId){local.Callbacks.execute(callbackId,[obj])}if(obj.success&&!obj.hideUI){return exports.UI.createNotification({title:"Success!",html:"Your screenshot was added to Clay.io"})}else if(!obj.hideUI){return exports.UI.createNotification({title:"Error",html:obj.error})}};return Screenshot}()});namespace("Clay",function(exports){return exports.Social=function(){function Social(){}Social.linked=false;Social.listening=false;Social.listen=function(options){if(!this.listening){local.Events.socketListen(options.type,this,false,false);return this.listening=true}};Social.superPost=function(options,callback){var callbackId,prettyType,_this=this;if(options==null){options={}}if(callback==null){callback=false}if(options.type==="facebook"){prettyType="Facebook"}else if(options.type==="twitter"){prettyType="Twitter"}else{prettyType="Clay.io"}if(local.Offline.offline){local.Offline.showWarning("post a message to "+prettyType);return}else{this.listen(options)}if(typeof options!=="object"){exports.log("This form of passing post message is deprecated");options={message:options}}if(typeof callback==="number"){this.callbackId=callbackId=callback}else if(callback){this.callbackId=callbackId=local.Callbacks.add(callback)}return exports.player.requireLogin(function(){var events,handler,html;if(options.editable){html=[];html.push("<textarea id='clay-share-message'>"+options.message+"</textarea>");html.push("<div><a href='#' id='clay-share-button-a' class='clay-button'>Share</a></div>");handler=function(){var newCallback;document.getElementById("clay-share-button-a").innerHTML="Loading...";newCallback=function(obj){exports.UI.closeModal("clay-share-wrapper");if(callback){return callback(obj)}};options.message=document.getElementById("clay-share-message").value;options.editable=false;_this.post(options,newCallback);return false};events=[{id:"clay-share-button-a",action:"click",handler:handler}];return Clay.UI.createModal({title:"Share Clay.io on "+prettyType,html:html,id:"clay-share-wrapper",events:events})}else{options.posting=true;return local.Events.socketEmit(options.type,"post",options,false,callbackId)}},true)};Social.postCallback=function(obj,callbackId){if(!obj.error&&!obj.hideUI){exports.UI.createNotification({title:obj.title,html:obj.content})}return local.Callbacks.execute(callbackId,[obj])};Social.prototype.tries=0;Social.requestPermission=function(options,callbackId){var permissionCallback,_this=this;if(options==null){options={}}if(callbackId==null){callbackId=false}if(this.tries>4){return}this.tries++;if(options.type==="clay"){options={title:"Grant Permissions",iframe:{src:exports.BASEURL+"/api/social/clay?site="+options.type+"&id="+Clay.gameID,id:"clay-"+options.type+"-iframe"},id:"clay-"+options.type+"-wrapper"};exports.UI.createModal(options);permissionCallback=function(event){var json;if(~exports.BASEURL.indexOf(event.origin)){json=JSON.parse(event.data);if(json.success){exports.UI.closeModal("clay-"+options.type+"-wrapper");options.reloadUser=true;_this.post(options);return local.Events.removeEvent("message",arguments.callee)}else if(json.success===false){exports.UI.closeModal("clay-"+options.type+"-wrapper");return local.Events.removeEvent("message",arguments.callee)}}};return local.Events.addEvent("message",permissionCallback)}else{return this.connect(options,function(){if(options.posting){options.reloadUser=true;return _this.post(options,_this.callbackId)}else if(callbackId){return local.Callbacks.execute(callbackId,[options])}})}};Social.superConnect=function(options,callback){var frame,linkCallback,use,_this=this;if(callback==null){callback=false}use=options.use?options.use:"clay";frame=document.createElement("iframe");frame.src=exports.BASEURL+"/api/social/"+options.type+"?use="+use;frame.frameBorder="";frame.id="clay-"+options.type+"-iframe";exports.UI.addToContainer(frame);linkCallback=function(event){var json;if(~exports.BASEURL.indexOf(event.origin)){json=JSON.parse(event.data);if(json.success){if(callback){callback(json)}}if(json.success||json.hash){exports.UI.removeElement("clay-"+options.type+"-iframe");local.Events.removeEvent("message",arguments.callee)}if(json.popup&&!options.hideUI){exports.UI.showPopupNotifier(json.popup)}if(json.popupClose&&!options.hideUI){return exports.UI.hidePopupNotifier(json.popupClose)}}};return local.Events.addEvent("message",linkCallback)};Social.share=function(options,callback){var events,html,message,modalOptions,shareClick,shareFacebook,shareTwitter;if(options==null){options={}}if(callback==null){callback=false}message=options.message||"";html=[];html.push("<textarea id='clay-share-message' placeholder='Enter your message...'>"+message+"</textarea>");html.push("<input type='checkbox' id='clay-share-screenshot'>");html.push("<label for='clay-share-screenshot'>Include Screenshot</label>");html.push("<div class='clay-share-buttons'>");html.push("	<a class='clay-share-button' id='clay-share-facebook'>");html.push("		<span class='clay-share-button-action clay-share-button-facebook'>Share</span>");html.push("	</a>");html.push("	<a class='clay-share-button' id='clay-share-twitter'>");html.push("		<span class='clay-share-button-action clay-share-button-tweet'>Tweet</span>");html.push("	</a>");html.push("</div>");events=[];shareClick=function(type){var postMessage,screenshot,screenshotEle;postMessage=function(screenshot){var messageEle;if(screenshot==null){screenshot=false}messageEle=document.getElementById("clay-share-message");message=messageEle?messageEle.value:"";if(screenshot){message+=" "+screenshot}return(new exports[type]).post({message:message},function(response){return callback(response)})};screenshotEle=document.getElementById("clay-share-screenshot");if(screenshotEle&&screenshotEle.checked){screenshot=new exports.Screenshot({prompt:false});return screenshot.save(function(response){return postMessage(response.url)})}else{return postMessage()}};shareFacebook=function(){return shareClick("Facebook")};shareTwitter=function(){return shareClick("Twitter")};events.push({id:"clay-share-facebook",action:"click",handler:shareFacebook});events.push({id:"clay-share-twitter",action:"click",handler:shareTwitter});modalOptions={title:"Share Options",html:html,id:"clay-share-wrapper",events:events};return exports.UI.createModal(modalOptions)};return Social}()});namespace("Clay",function(exports){return exports.Stream=function(_super){__extends(Stream,_super);function Stream(){}Stream.post=function(options,callback){if(options==null){options={}}if(callback==null){callback=false}options.type="stream";return this.superPost(options,callback)};Stream.prototype.post=function(options,callback){if(callback==null){callback=false}exports.Stream.post(options,callback)};return Stream}(exports.Social)});namespace("Clay",function(exports){return exports.Twitter=function(_super){__extends(Twitter,_super);function Twitter(){}Twitter.post=function(options,callback){if(options==null){options={}}if(callback==null){callback=false}options.type="twitter";return this.superPost(options,callback)};Twitter.prototype.post=function(options,callback){if(callback==null){callback=false}exports.Twitter.post(options,callback)};Twitter.connect=function(options,callback){if(options==null){options={}}if(callback==null){callback=false}options.type="twitter";return this.superConnect(options,callback)};return Twitter}(exports.Social)});namespace("Clay",function(exports){return exports.Facebook=function(_super){__extends(Facebook,_super);function Facebook(){}Facebook.post=function(options,callback){if(options==null){options={}}if(callback==null){callback=false}options.type="facebook";return this.superPost(options,callback)};Facebook.prototype.post=function(options,callback){if(callback==null){callback=false}exports.Facebook.post(options,callback)};Facebook.connect=function(options,callback){if(options==null){options={}}if(callback==null){callback=false}options.type="facebook";return this.superConnect(options,callback)};Facebook.invite=function(options,callback){var caption,ele,html,listenCallback,modalOptions;if(options==null){options={}}if(callback==null){callback=false}html=[];caption=options.caption?encodeURIComponent(options.caption):"";html.push("<iframe src='"+exports.BASEURL+"/api/facebookinvite?id="+exports.gameID+"&caption="+caption+"' id='clay-facebook-invite-iframe' frameBorder='0'></iframe>");modalOptions={title:"Invite Your Friends",html:html,id:"clay-facebook-invite-wrapper"};if(options.id&&(ele=document.getElementById(options.id))){ele.innerHTML=html.join("")}else{exports.UI.createModal(modalOptions)}listenCallback=function(event){var json;if(~exports.BASEURL.indexOf(event.origin)){json=JSON.parse(event.data);if(json.height){ele=document.getElementById("clay-facebook-invite-iframe");ele.height=json.height;ele.style.height=json.height+"px";exports.UI.centerModal("clay-facebook-invite-wrapper")}if(json.popup){exports.UI.showPopupNotifier(json.popup)}if(json.popupClose){exports.UI.hidePopupNotifier(json.popupClose)}if(json.success){if(callback){return callback({success:true})}}}};return local.Events.addEvent("message",listenCallback)};return Facebook}(exports.Social)});namespace("Clay",function(exports){exports.Achievement=function(){exports.achievementsAwarded={};Achievement.achievementObjs={};function Achievement(options){this.options=options;if(typeof this.options!=="object"){exports.log("This form of passing achievement ID is deprecated");this.options={id:this.options}}this.instanceId=Math.random();if(!local.Offline.offline){local.Events.socketListen("achievement",this,false,false)}}Achievement.prototype.award=function(callback){var callbackId,obj;if(!local.validCall()){return"Achievement awarded!"}if(!exports.achievementsAwarded[this.options.id]){callbackId=local.Callbacks.add(callback);exports.achievementsAwarded[this.options.id]=true;if(local.Offline.offline){exports.log("Achievement earned offline");obj={title:"Test",description:"Description"};this.show(obj,callbackId);return local.Offline.save("achievement","award",this.options.id,this.options,true)}else{return local.Events.socketEmit("achievement","award",this.options,this.instanceId,callbackId)}}};Achievement.prototype.show=function(obj,callbackId){var url;url=window.location!==window.parent.location?document.referrer:document.location.href;if(obj.success&&(~url.indexOf(exports.DOMAIN)||obj.showExternally)){if(!obj.hideUI){if(exports.player.clearance!=="clay"){obj.description+="<br /><a href='javascript: void( 0 );' onclick='Clay.player.login();'>Login</a> to claim"}exports.UI.createNotification({title:obj.title,html:obj.description,icon:obj.icon,type:"achievement"})}}return local.Callbacks.execute(callbackId,[obj])};Achievement.showAll=function(options,callback){var callbackId;if(callback==null){callback=false}if(callback){callbackId=local.Callbacks.add(callback)}return local.Events.socketEmit("achievement","showAll",options,null,callbackId)};Achievement.fetchAll=function(options,callback){if(options==null){options={}}if(callback==null){callback=false}options.fetch=true;return this.showAll(options,callback)};Achievement.showAllCallback=function(obj,callbackId){var achievement,achievements,html,i,options,_i,_len;if(callbackId==null){callbackId=false}html=[];achievements=obj.data;i=0;if(!achievements||!achievements.length){html.push("This game does not have any achievements!")}else{for(_i=0,_len=achievements.length;_i<_len;_i++){achievement=achievements[_i];if(!(i%2)){html.push("<div class='clay-achievement-row'>")}html.push("<div class='clay-achievement-single");if(achievement.icon){html.push(" clay-achievement-with-icon")}if(achievement.earned){html.push(" clay-achievement-single-achieved' title='You&#39;ve earned this achievement!'")}if(!achievement.earned){html.push("' title='You haven&#39;t earned this achievement yet.'")}html.push(">");html.push("<div class='clay-achievement-single-inner'>");if(achievement.earned){html.push("<div class='clay-checkmark-before'");if(achievement.icon){html.push(" style='background-image: url( "+achievement.icon+" );'")}html.push("></div><div class='clay-checkmark'></div><div class='clay-checkmark-after'></div>")}else{html.push("<div class='clay-xmark-before'");if(achievement.icon){html.push(" style='background-image: url( "+achievement.icon+" );'")}html.push("></div><div class='clay-xmark'></div><div class='clay-xmark-after'>&times;</div>")}html.push(achievement.title);html.push(" <span class='clay-achievement-points' title='"+achievement.points+" points'>("+achievement.points+")</span>");html.push("<div class='clay-achievement-single-description'>"+achievement.description+"</div>");html.push("</div>");html.push("</div>");if(i%2){html.push("</div>")}i++}}options={title:"Achievements",html:html,id:"clay-achievements-wrapper"};if(obj.DOMid){options.DOMid=obj.DOMid}exports.UI.createModal(options,function(){var ele;ele=document.querySelector(".clay-achievement-single-description");if(ele){return ele.style.width="100%"}});if(callbackId){return local.Callbacks.execute(callbackId,[obj])}};Achievement.fetchAllCallback=function(obj,callbackId){if(callbackId==null){callbackId=false}if(callbackId){return local.Callbacks.execute(callbackId,[obj])}};Achievement.prototype.requestFacebook=function(obj){var callback,callbackId,_this=this;callback=function(){return local.Events.socketEmit("achievement","facebook",obj,_this.instanceId)};callbackId=local.Callbacks.add(callback);return exports.Facebook.requestPermission(obj,callbackId)};return Achievement}();return exports.readyFunctions.push(function(){return local.Events.socketListen("achievement",exports.Achievement,false,false)
})});namespace("Clay",function(exports){return exports.Advertisement=function(){Advertisement.prototype.visible=false;Advertisement.prototype.skippable=false;function Advertisement(options){var size,skip;this.options=options!=null?options:{};skip=false;this.device=exports.checkDevice();if(this.options.devices==="desktop"&&this.device==="mobile"){skip=true}else if(this.options.devices==="mobile"&&this.device==="desktop"){skip=true}if(this.options.position&&this.options.position.parent&&typeof this.options.position.parent==="string"){this.options.position.parent=document.getElementById(this.options.position.parent)}if(!skip){size=this.checkFormat();if(this.options.size==="preroll"||this.options.size==="preroll-video"){this.loadPrerollAd()}else{this.loadStandardAd()}this.visible=true}}Advertisement.prototype.innerAd=null;Advertisement.prototype.loadPrerollAd=function(){var gameName,prerollHTML,size,_this=this;if(typeof this.options.duration==="undefined"){this.options.duration=15e3}prerollHTML=[];prerollHTML.push("<div class='clay-preroller-wrapper' id='clay-preroller-wrapper'>");if(this.device==="mobile"){size="wall"}else if(this.options.size==="preroll-video"){size="video"}else{size="300x250"}prerollHTML.push("	<div class='clay-preroller"+(size==="wall"||size==="video"?"-full":"")+"'>");prerollHTML.push("		<h4>Advertisement</h4>");prerollHTML.push("		<div class='clay-preroller-content' id='clay-preroller-content'>	");prerollHTML.push("		</div>");prerollHTML.push("		<div class='clay-load-bar' id='clay-load-bar'>");prerollHTML.push("			<div class='clay-load-bar-progress' id='clay-load-bar-progress'></div>");gameName=exports.Game.data&&exports.Game.data.name?exports.Game.data.name:exports.gameKey;prerollHTML.push("			<div class='clay-load-bar-text' id='clay-load-bar-text'>Loading "+gameName+"...</div>");prerollHTML.push("		</div>");prerollHTML.push("	</div>");prerollHTML.push("</div>");return exports.UI.addToContainer(prerollHTML,function(){_this.innerAd=new exports.Advertisement({size:size,position:{inline:true,parent:document.getElementById("clay-preroller-content")}});return _this.startLoadBar(_this.options.duration)})};Advertisement.prototype.loadProgress=0;Advertisement.prototype.timePass=0;Advertisement.prototype.startLoadBar=function(time){var startTime,_this=this;this.loadBar=document.getElementById("clay-load-bar-progress");if(this.options.duration){startTime=(new Date).getTime();return this.loaderInterval=setInterval(function(){var currentTime,loaderWidth;currentTime=(new Date).getTime();_this.timePassed=currentTime-startTime;_this.loadProgress=loaderWidth=100*(_this.timePassed/time);_this.updateLoadBar();if(loaderWidth>=100){clearInterval(_this.loaderInterval);_this.loadProgress=100;_this.hidePreroll()}if(_this.timePassed>=_this.options.skipDuration&&!_this.skippable){return _this.startSkip()}},100)}};Advertisement.prototype.updateLoadBar=function(){if(this.loadBar){return this.loadBar.style.width=this.loadProgress+"%"}};Advertisement.prototype.hidePreroll=function(){exports.UI.removeElement("clay-preroller-wrapper");if(this.loaderInterval){clearInterval(this.loaderInterval)}if(this.options.onHide){return this.options.onHide()}};Advertisement.prototype.done=function(){if(this.options.allowSkip===true&&this.options.duration!==false){this.startSkip()}else{this.hidePreroll()}return this};Advertisement.prototype.startSkip=function(){var ele,skipLink,_this=this;ele=document.getElementById("clay-load-bar-text");if(!ele){return}ele.innerHTML="";skipLink=document.createElement("a");skipLink.href="#";skipLink.onclick=function(e){e.preventDefault();return _this.hidePreroll()};skipLink.appendChild(document.createTextNode("Skip"));ele.appendChild(skipLink);this.skippable=true;if(this.options.onSkipStart){return this.options.onSkipStart()}};Advertisement.prototype.loadStandardAd=function(){var adFrame,height,text,width,_this=this;if((document.location.hostname==="localhost"||document.location.hostname==="127.0.0.1")&&this.options.size!=="cross-promotion-bar"){adFrame=document.createElement("div");adFrame.style.background="#000";adFrame.style.padding="10px";adFrame.style.boxSizing="border-box";text=document.createTextNode("Ads do not show on localhost");adFrame.appendChild(text)}else{adFrame=document.createElement("iframe");if(this.options.size==="cross-promotion-bar"){adFrame.src=exports.BASEURL+"/api/bar?key="+exports.gameKey}else{adFrame.src=exports.BASEURL+"/api/ad?key="+exports.gameKey+"&size="+this.options.size+"&pub="+exports.publisherID}adFrame.frameBorder=0}if(this.options.size==="cross-promotion-bar"){if(this.device==="mobile"){width="320px";height="50px"}else if(this.options.position){width=this.options.position.width;height=this.options.position.height}else{width="100%";height="80px"}this.size=[parseInt(width),parseInt(height)];adFrame.style.width=width;adFrame.style.height=height;adFrame.src+="&height="+height+"&width="+width}else if(this.options.size==="video"||this.options.size==="wall"){this.size=["100%","100%"];adFrame.style.width=this.size[0];adFrame.style.height=this.size[1]}else{this.size=this.options.size.split("x");adFrame.style.width=this.size[0]+"px";adFrame.style.height=this.size[1]+"px"}adFrame.style.overflow="hidden";if(typeof this.options.show!=="undefined"&&this.options.show===false){adFrame.style.display="none"}this.frame=adFrame;if(this.options.position&&this.options.position.inline){this.options.position.parent.appendChild(adFrame)}else{adFrame.style.position="absolute";adFrame.style.zIndex=9999;if(this.options.position){this.setPosition(this.options.position)}else{adFrame.style.top=0;adFrame.style.left=0}this.updatePosition();local.Events.addEvent("resize",function(){return _this.updatePosition()});if(local.container){local.container.appendChild(adFrame)}}if(this.options.refreshInterval){return this.refreshInterval=setInterval(function(){return _this.refresh()},this.options.refreshInterval*1e3)}};Advertisement.prototype.setRefreshInterval=function(seconds){var _this=this;clearInterval(this.refreshInterval);this.refreshInterval=setInterval(function(){return _this.refresh()},seconds*1e3);return this};Advertisement.prototype.parsePosition=function(){var height,offset,pageOffset,pos,position,positions,scale,scaleHeight,scaleWidth,style,validStyles,width,_base1,_i,_len;position={};(_base1=this.options).position||(_base1.position=[]);positions=["top","left","right","bottom"];validStyles=["top","left","right","bottom","webkitTransform","mozTransform","msTransform"];offset={top:0,left:0,right:0,bottom:0};if(this.options.position.parent){pageOffset=this.getOffset(this.options.position.parent);offset={top:pageOffset.top,left:pageOffset.left,right:document.body.clientWidth-pageOffset.left,bottom:document.body.clientHeight-pageOffset.top}}for(_i=0,_len=validStyles.length;_i<_len;_i++){style=validStyles[_i];pos=this.options.position[style];if(typeof pos!=="undefined"&&positions.indexOf(style)!==-1){if(typeof pos==="string"&&pos.indexOf("%")!==-1&&this.options.position.parent){if(style==="left"||style==="right"){pos=parseInt(pos)/100*this.options.position.parent.offsetWidth}else{pos=parseInt(pos)/100*this.options.position.parent.offsetHeight}pos=parseInt(pos)}if(typeof pos!=="string"||pos.indexOf("%")===-1&&pos.indexOf("px")===-1){pos+=offset[style];pos+="px"}position[style]=pos;if(this.options.position.reference==="center"){width=this.options.position["scaleWidth"]||this.size[0];height=this.options.position["scaleHeight"]||this.size[1];if(style==="left"){position["margin-left"]=-1*width/2+"px"}else if(style==="right"){position["margin-right"]=-1*width/2+"px"}else if(style==="top"){position["margin-top"]=-1*height/2+"px"}else if(style==="bottom"){position["margin-bottom"]=-1*height/2+"px"}}}}if(this.options.position["scaleWidth"]||this.options.position["scaleHeight"]){if(this.options.position["scaleWidth"]){scaleWidth=this.options.position["scaleWidth"]/this.size[0]}else{scaleWidth=1}if(this.options.position["scaleHeight"]){scaleHeight=this.options.position["scaleHeight"]/this.size[1]}else{scaleHeight=1}scale="scale( "+scaleWidth+", "+scaleHeight+" )";position["-webkit-transform"]=scale;position["-moz-transform"]=scale;position["-ms-transform"]=scale;position["transform"]=scale;position["-webkit-transform-origin"]="0 0";position["-moz-transform"]="0 0";position["-ms-transform"]="0 0";position["transform"]="0 0"}return position};Advertisement.prototype.getOffset=function(el){var x,y;x=0;y=0;while(el&&!isNaN(el.offsetLeft)&&!isNaN(el.offsetTop)){x+=el.offsetLeft;y+=el.offsetTop;el=el.offsetParent}return{top:y,left:x}};Advertisement.validFormats=["160x600","728x90","300x250","120x600","200x200","468x60","125x125","320x50","preroll","preroll-video","cross-promotion-bar","video","wall"];Advertisement.prototype.checkFormat=function(){var _base1;(_base1=this.options).size||(_base1.size="");this.options.size=this.options.size.toLowerCase();if(exports.Advertisement.validFormats.indexOf(this.options.size)===-1){this.options.size=exports.Advertisement.validFormats[0]}return this.options.size};Advertisement.prototype.show=function(){this.visible=true;if(this.options.size==="preroll"||this.options.size==="preroll-video"){exports.log("Advertisement.show() is not a valid method for preroll advertisements. Prerolls are shown automatically on creation.")}else{if(this.frame){this.frame.style.display="block"}}return this};Advertisement.prototype.hide=function(){this.visible=false;if(this.options.size==="preroll"||this.options.size==="preroll-video"){this.done()}else{if(this.frame){this.frame.style.display="none"}}return this};Advertisement.prototype.remove=function(){this.visible=false;if(this.options.size==="preroll"||this.options.size==="preroll-video"){this.done()}else{if(this.frame){exports.UI.removeElement(this.frame)}clearInterval(this.refreshInterval)}return this};Advertisement.prototype.lastRefresh=0;Advertisement.prototype.refresh=function(){var curTime;curTime=(new Date).getTime();if(!this.frame.parentNode){clearInterval(this.refreshInterval)}if(this.visible&&curTime-this.lastRefresh>3e4){if(this.frame){this.frame.src=this.frame.src}this.lastRefresh=curTime}return this};Advertisement.prototype.setProgress=function(progress){this.loadProgress=100*progress;this.updateLoadBar();return this};Advertisement.prototype.getDurationRemaining=function(type){var timeLeft;if(type==null){type="load"}if(type==="load"){timeLeft=this.options.duration-this.timePassed;if(timeLeft>0){return timeLeft}else{return 0}}else if(type==="skip"){timeLeft=this.options.skipDuration-this.timePassed;if(timeLeft>0){return timeLeft}else{return 0}}};Advertisement.prototype.setPosition=function(position){var style,value;for(style in position){value=position[style];this.options.position[style]=value}if(position&&position.parent){this.options.position.parent=position.parent}if(typeof this.options.position.top==="undefined"&&this.options.position.right==="undefined"&&this.options.position.bottom==="undefined"&&this.options.position.left==="undefined"){this.options.position.top=0;this.options.position.left=0}this.updatePosition();return this};Advertisement.prototype.updatePosition=function(){var style,styles,value,_results;if(!this.frame){return}styles=this.parsePosition();_results=[];for(style in styles){value=styles[style];_results.push(this.frame.style.setProperty(style,value))}return _results};return Advertisement}()});namespace("Clay",function(exports){exports.Bar=function(_super){__extends(Bar,_super);function Bar(options,callback){var _base1,_base2;if(options==null){options={}}options.size="cross-promotion-bar";options.position||(options.position={});(_base1=options.position).width||(_base1.width="100%");(_base2=options.position).height||(_base2.height="80px");if(options.position.parent&&options.position.inline!==false){options.position.inline=true}Bar.__super__.constructor.call(this,options)}return Bar}(exports.Advertisement);return exports.Suggestions=function(){function Suggestions(options,callback){var modalOptions;if(options==null){options={}}modalOptions={title:"More Games",html:"",id:"clay-suggestions-wrapper"};if(options.DOMid){modalOptions.DOMid=options.DOMid}exports.UI.createModal(modalOptions,function(){options={position:{width:"300px",height:"300px",left:"50%",top:"50%",reference:"center",parent:"clay-suggestions-wrapper-content-inner"}};console.log(options);return new exports.Bar(options)})}return Suggestions}()});namespace("Clay",function(exports){return exports.Leaderboard=function(){Leaderboard.prototype.challenge=null;function Leaderboard(options){this.options=options;if(typeof this.options!=="object"){exports.log("This form of passing leaderboard ID is deprecated");this.options={id:this.options}}this.instanceId=Math.random();if(!local.Offline.offline){local.Events.socketListen("leaderboard",this,false,false)}}Leaderboard.prototype.setData=function(options){return this.options.data=options.data};Leaderboard.prototype.fetch=function(options,callback){if(options==null){options={}}if(callback==null){callback=false}options.fetch=true;return this.show(options,callback)};Leaderboard.prototype.show=function(options,callback){var callbackId,html,modalOptions;if(options==null){options={}}if(callback==null){callback=false}if(this.options.id&&!options.id){options.id=this.options.id}if(this.options.data&&!options.data){options.data=this.options.data}if(this.options.tabs&&!options.tabs){options.tabs=this.options.tabs}if(this.options.filters&&!options.filters){options.filters=this.options.filters}this.prevTab=0;this.tabs={};if(!options.fetch){html="";modalOptions={title:"Loading Leaderboard...",html:html,id:"clay-leaderboard-wrapper",loading:true};exports.UI.createModal(modalOptions)}if(callback){callbackId=local.Callbacks.add(callback)}return local.Events.socketEmit("leaderboard","show",options,this.instanceId,callbackId)};Leaderboard.prototype.returnJSON=function(obj,callbackId){var results;results=obj.data||{};if(obj.getRank){results={data:results,rank:obj.rank}}if(callbackId){return local.Callbacks.execute(callbackId,[results])}};Leaderboard.prototype.display=function(obj,callbackId){var ele,events,handler,header,i,leaderboard,options,position,subnavHTML,tab,table,tabs,width,_fn,_i,_j,_len,_len1,_ref,_ref1,_this=this;if(callbackId==null){callbackId=false}this.tabs[this.prevTab]=obj;leaderboard=[];if(!obj.name){obj.name=""}if(obj.requireLogin){leaderboard.push("<p>You must <a href='#' id='clay-leaderboard-login'>login</a> to Clay.io to view your friends' scores</p>");handler=function(){exports.Player.login(function(){obj.reloadUser=true;obj.requireLogin=false;return _this.show(obj)});return false};events=[{id:"clay-leaderboard-login",action:"click",handler:handler}]}else{if(obj.html){leaderboard.push("<div class='clay-leaderboard-custom-html'>"+obj.html+"</div>")}if(obj.personal){leaderboard.push("<div class='clay-leaderboard-personal' id='clay-leaderboard-personal-"+this.instanceId+"'>"+obj.personal+"</div>")}events=[];tabs=[];if(obj.tabs&&obj.tabs.length>1){_ref=obj.tabs;_fn=function(){var index,localTab,onClick;index=i;localTab=tab;onClick=function(){localTab.index=index;return _this.setTab(localTab)};return tabs.push({name:tab.title,focused:_this.prevTab===index,callback:onClick})};for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){tab=_ref[i];_fn()}}leaderboard.push("<div class='clay-leaderboard-table-wrapper' id='clay-leaderboard-table-"+this.instanceId+"'>");table=this.getTable(obj);leaderboard.push(table.html.join(""));leaderboard.push("</div>");if(table.events&&table.events.length){events=events.concat(table.events)}subnavHTML="";subnavHTML+="<div class='clay-td-first' style='width: 15%'>Rank</div>";_ref1=obj.header;for(i=_j=0,_len1=_ref1.length;_j<_len1;i=++_j){header=_ref1[i];if(i===obj.header.length-1){position="-last"}else{position=""}width=85/obj.header.length;if(header==="Name"){width=Math.round(10*width*1.4)/10}if(header==="Score"){width=Math.round(10*width*.6)/10}subnavHTML+="<div class='clay-td"+position+"' style='width: "+width+"%'>"+header+"</div>"}}ele=document.getElementById("clay-leaderboard-wrapper");options={title:obj.name||"Leaderboard",html:leaderboard,id:"clay-leaderboard-wrapper",events:events,tabs:tabs,subnav:subnavHTML,loading:false};if(ele&&ele.style.display!=="none"){exports.UI.updateModal(options)}else{exports.UI.createModal(options)}if(callbackId){return local.Callbacks.execute(callbackId,[obj])}};Leaderboard.prototype.hide=function(){return exports.UI.closeModal("clay-leaderboard-wrapper")};Leaderboard.prototype.setTabs=function(options){return this.options.tabs=options.tabs};Leaderboard.prototype.setTab=function(options){var fromFilterBox,indicator,key,newTab,oldTab;fromFilterBox=typeof options.selected!=="undefined";oldTab=document.getElementById("clay-leaderboard-tab-"+this.prevTab);if(oldTab&&!fromFilterBox){oldTab.className=""}newTab=document.getElementById("clay-leaderboard-tab-"+options.index);if(newTab&&!fromFilterBox){newTab.className="clay-tab-focus"}indicator=document.getElementById("clay-leaderboard-wrapper-scroll-indicator");exports.UI.removeElement(indicator);this.prevTab=options.index;key=options.index+(fromFilterBox?"-"+options.selected:"");this.prevTabFilter=key;if(this.tabs[key]){this.setTabCallback(this.tabs[key]);return}return local.Events.socketEmit("leaderboard","setTab",options,this.instanceId)};Leaderboard.prototype.setTabCallback=function(obj){var ele,personal,table,_base1,_name;(_base1=this.tabs)[_name=this.prevTabFilter]||(_base1[_name]=obj);document.getElementById("clay-leaderboard-wrapper-title").innerHTML=obj.name;table=this.getTable(obj);document.getElementById("clay-leaderboard-table-"+this.instanceId).innerHTML=table.html.join("");if(table.events&&table.events.length){exports.UI.handleEvents(table.events)}exports.UI.centerModal("clay-leaderboard-wrapper");personal=obj.personal||"";ele=document.getElementById("clay-leaderboard-personal-"+this.instanceId);if(ele){return ele.innerHTML=personal}};Leaderboard.prototype.removeEntry=function(options){exports.UI.removeElement("clay-leaderboard-entry-"+options.id);return local.Events.socketEmit("leaderboard","removeEntry",options,this.instanceId)};Leaderboard.prototype.removeEntryCallback=function(obj){if(obj.error){return exports.log("There was an error deleting that leaderboard score! "+obj.error)}};Leaderboard.prototype.share=function(obj){var ele,entries,facebook,gameLink,lsd,parent,rank,row,score,shareWrapper,text,twitter;if(window.CocoonJS&&window.CocoonJS.App||exports.windows8){return}ele=document.getElementById("clay-leaderboard-share-wrapper-"+obj.id);if(ele){return ele.parentNode.removeChild(ele)}else{row=document.getElementById("clay-leaderboard-entry-"+obj.id);shareWrapper=document.createElement("div");shareWrapper.className="clay-share-score-wrapper";shareWrapper.id="clay-leaderboard-share-wrapper-"+obj.id;entries=document.getElementsByClassName("clay-leaderboard-entry");if(entries&&entries.length&&entries[entries.length-1].id===row.id){shareWrapper.className+=" clay-share-score-wrapper-top"}score=row.getAttribute("data-score");rank=row.getAttribute("data-rank");lsd=rank.charAt(rank.length-1);if(lsd==="1"){rank+="st"}else if(lsd==="2"){rank+="nd"}else if(lsd==="3"){rank+="rd"}else{rank+="th"}gameLink=local.getGameLink();facebook=document.createElement("a");facebook.className="clay-share-score-facebook";facebook.href="#";facebook.onclick=function(event){var message;message="I just scored "+score+" and am ranked "+rank+" in "+exports.Game.data.name+". Think you can beat my score?";if(exports.Facebook){(new exports.Facebook).post({message:message+" "+gameLink})}else{window.open("http://www.facebook.com/sharer/sharer.php?s=100&p[url]="+gameLink+"&p[title]="+exports.Game.data.name+"&p[summary]="+encodeURIComponent(message))}ele=document.getElementById("clay-leaderboard-share-wrapper-"+obj.id);if(ele){ele.parentNode.removeChild(ele)}return event.preventDefault()};text=document.createTextNode("Share on Facebook");facebook.appendChild(text);twitter=document.createElement("a");twitter.className="clay-share-score-twitter";twitter.href="#";twitter.onclick=function(event){var message;message="I just scored "+score+" and am ranked "+rank+" in "+exports.Game.data.name+". Think you can beat my score? "+gameLink;if(exports.Twitter){(new exports.Twitter).post({message:message})}else{window.open("http://twitter.com/home?status="+encodeURIComponent(message))}ele=document.getElementById("clay-leaderboard-share-wrapper-"+obj.id);if(ele){ele.parentNode.removeChild(ele)}return event.preventDefault()};text=document.createTextNode("Share on Twitter");twitter.appendChild(text);shareWrapper.appendChild(facebook);shareWrapper.appendChild(twitter);parent=document.getElementById("clay-leaderboard-share-"+obj.id);if(parent){parent=parent.parentNode}if(parent){return setTimeout(function(){return parent.appendChild(shareWrapper)},0)}}};Leaderboard.prototype.getTable=function(obj){var colSpan,events,filter,filterHTML,html,i,onChange,rank,row,trFromRow,_i,_j,_len,_len1,_ref,_ref1,_this=this;html=[];events=[];filterHTML=false;if(obj.filters&&obj.filters.length>1){filterHTML=[];filterHTML.push("<select id='clay-leaderboard-filters'>");_ref=obj.filters;for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){filter=_ref[i];filterHTML.push("<option value='"+i+"'"+(filter.selected?" selected='selected'":"")+">");filterHTML.push(filter.title);filterHTML.push("</option>")}onChange=function(){var filters,newObj;filters=document.getElementById("clay-leaderboard-filters");if(filters){newObj=JSON.parse(JSON.stringify(obj.filters[filters.value]));newObj.index=_this.prevTab||0;newObj.selected=filters.value;return _this.setTab(newObj,filters.value)}};events.push({id:"clay-leaderboard-filters",action:"change",handler:onChange})}html.push("<table>");html.push("<thead>");if(filterHTML){colSpan=obj.header&&obj.header.length?obj.header.length+1:0;html.push("<tr><th class='clay-leaderboard-filters' colspan='"+colSpan+"'>");html.push("Filter by: "+filterHTML.join(""));html.push("</th></tr>")}html.push("</thead>");html.push("<tbody>");if(!obj.data||obj.data.length===0||obj.data[0].length===0){html.push("<tr><td colspan='"+obj.header.length+"'>No high scores yet!</td></tr>")}else{trFromRow=function(row,rank){var columns,fraction,id,integer,pieces,shareOnClick,text,width,_j,_len1;html.push("<tr class='"+(row.me?"clay-leaderboard-me":"")+" clay-leaderboard-entry' id='"+(row.id?"clay-leaderboard-entry-"+row.id:"clay-leaderboard-entry-"+rank)+"' data-score='"+row.score+"' data-rank='"+rank+"'>");html.push("<td class='clay-leaderboard-rank' style='width: 15%;'>"+rank+"</td>");if(obj.customData){columns=Object.keys(row)}else{columns=["name","score"]}for(_j=0,_len1=columns.length;_j<_len1;_j++){i=columns[_j];text=row[i];width=85/obj.header.length;if(i==="name"){width=Math.round(10*width*1.4)/10}if(i==="score"){width=Math.round(10*width*.6)/10}html.push("<td style='width: "+width+"%;'>");html.push("<div class='relative'>");if(typeof text==="number"){text=text.toString();if(text.indexOf(".")!==-1){pieces=text.split(".");integer=pieces[0];integer=integer.replace(/\B(?=(\d{3})+(?!\d))/g,",");fraction=pieces[1];text=integer+"."+fraction}else{text=text.replace(/\B(?=(\d{3})+(?!\d))/g,",")}}if(i==="name"&&row.user_id){html.push("<img src='"+exports.BASEURL+"/avatar/"+row.user_id+"/40' /> ");html.push("<a href='"+exports.BASEURL+"/userid/"+row.user_id+"' class='clay-pad-link' target='_blank'>");html.push(local.htmlEntities(text));html.push("</a>")}else{if(obj.allowHTML){html.push(text)}else{html.push(local.htmlEntities(text))}if(row.me&&i==="score"&&exports.Player.loggedIn&&exports.Player.clearance==="clay"){id=row.id||rank;shareOnClick=function(event){_this.share({id:id});event.preventDefault();return event.stopPropagation()};html.push("<div class='clay-share-score'>");html.push("	<a href='#' id='clay-leaderboard-share-"+id+"' class='clay-share-score-link'>share</a>");html.push("</div>");events.push({id:"clay-leaderboard-share-"+id,action:"click",handler:shareOnClick})}if(obj.admin&&i==="score"){(function(){var deleteOnClick;id=row.id;deleteOnClick=function(){_this.removeEntry({id:id});return false};html.push("<a id='clay-leaderboard-remove-"+row.id+"' class='clay-close'></a>");return events.push({id:"clay-leaderboard-remove-"+row.id,action:"click",handler:deleteOnClick})})()}}html.push("</div>");html.push("</td>")}return html.push("</tr>")};_ref1=obj.data;for(rank=_j=0,_len1=_ref1.length;_j<_len1;rank=++_j){row=_ref1[rank];trFromRow(row,rank+1)}if(obj.rank&&obj.rank.rank>obj.data.length){if(obj.rank.rank>obj.data.length+1){html.push("<tr class='clay-leaderboard-filler-row'><td colspan='"+(obj.header.length+1)+"'>...</td></tr>")}trFromRow(obj.rank.row,obj.rank.rank)}}html.push("</tbody>");html.push("</table>");return{html:html,events:events}};Leaderboard.prototype.post=function(options,callback){var send,_this=this;if(!local.validCall()){return"Score posted! Scoreboard update soon."}send=function(){var callbackId,obj;if(typeof options!=="object"){exports.log("This form of passing leaderboard score is deprecated");options={score:options}}options.id=_this.options.id;if(callback){callbackId=local.Callbacks.add(callback)}if(local.Offline.offline){obj={title:"Score Saved",content:"Your score will be posted to the globl leaderboard when you connect to the internet"};_this.postCallback(obj,callbackId);return local.Offline.save("leaderboard","post",options.id,options,true)}else{return local.Events.socketEmit("leaderboard","post",options,_this.instanceId,callbackId)}};if(!local.Offline.offline&&!options.name){return exports.player.requireLogin(function(){return send()})}else{return send()}};Leaderboard.prototype.postCallback=function(obj,callbackId){var events,html,options,title;if(!obj.hideUI){exports.UI.createNotification({title:obj.title,html:obj.content})}if(exports.Leaderboard.challenge&&exports.Leaderboard.challenge.leaderboard_id===obj.leaderboard_id&&obj.score>exports.Leaderboard.challenge.score){html=[];html.push("<div class='clay-challenge-text'><strong>Congratulations, scored</strong></div>");html.push("<h1 class='clay-challenge-score'>You scored "+obj.score+"</h1>");html.push("<div class='clay-challenge-text'>You surpassed "+exports.Leaderboard.challenge.name+"'s score of "+exports.Leaderboard.challenge.score+"</div>");html.push("<div><input type='submit' value='Share Your Accomplishment' id='clay-challenge-share-button' /></div>");events=[];events.push({id:"clay-challenge-share-button",handler:function(){return exports.Links.create({type:"challenge",scoreId:obj.id},function(response){return exports.Social.share({message:"I just beat "+exports.Leaderboard.challenge.name+"'s score in "+Clay.Game.data.name+". Think you can beat my score? "+response.url})})}});title="You've Been Challenged!";options={id:"clay-challenge-wrapper",title:title,html:html,events:events};exports.UI.createModal(options)}return local.Callbacks.execute(callbackId,[obj])};Leaderboard.prototype.challenge=function(obj,callback){var events,html,onChange,onClick,options,score,_this=this;events=[];html=[];score=500;html.push("<h3 class='clay-challenge-score'>"+score+"</h3>");html.push("<div id='clay-challenge-direct-link-wrapper'>Generating direct link...</div>");if(exports.Twitter){html.push("<label for='clay-challenge-twitter'><input type='checkbox' id='clay-challenge-twitter' /> Post Challenge to Twitter</label>")}if(exports.Facebook){html.push("<label for='clay-challenge-facebook'><input type='checkbox' id='clay-challenge-facebook' /> Post Challenge to Facebook</label>")}html.push("<label for='clay-challenge-friends'><input type='checkbox' id='clay-challenge-friends' /> Challenge Facebook Friends</label>");html.push("<div id='clay-challenge-friends-frame'></div>");html.push("<div><input type='submit' id='clay-challenge-button' value='Challene Friends' /></div>");onChange=function(){var caption,iframe;iframe=document.createElement("iframe");caption="TODO";iframe.src=exports.BASEURL+"/api/facebookchallenge?id="+exports.gameID;iframe.frameBorder=0;return document.getElementById("clay-challenge-friends-frame").appendChild(iframe)};events.push({id:"clay-challenge-friends",action:"change",handler:onChange});onClick=function(){return _this.postChallenge()};events.push({parentElementId:"clay-challenge-button",action:"click",handler:onClick});options={title:"Challenge a Friend",html:html,id:"clay-challenge-wrapper",events:events};exports.UI.createModal(options);return local.Events.socketEmit("leaderboard","getDirectLink",this.options,this.instanceId)};Leaderboard.prototype.directLinkCallback=function(obj){var input,wrapper;wrapper=document.getElementById("clay-challenge-direct-link-wrapper");wrapper.innerHTML="";input=document.createElement("text");input.id="clay-challenge-direct-link";input.value=obj.link;wrapper.appendChild(input);return input.onclick=input.select()};Leaderboard.prototype.postChallenge=function(){var fb,link,message;link="";message="";fb=new exports.Facebook;return fb.post({message:message,link:link})};Leaderboard.prototype.requestFacebook=function(obj){var callback,_this=this;if(!this.fb){this.fb=new exports.Facebook}callback=function(){return local.Events.socketEmit("leaderboard","facebook",obj,_this.instanceId)};return this.fb.requestPermission(obj,callback)};return Leaderboard}()})}).call(this);